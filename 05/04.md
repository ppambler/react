### âœï¸ Tangxt â³ 2021-04-12 ğŸ·ï¸ epic

# 04-å®Œç»“ç¯‡ä¸Šä¼ å†å²çš„å®ç°

1ï¼‰äº§å“å®Œå–„ï¼šä¸Šä¼ é™åˆ¶ä¸åŠ è½½æç¤º

ç›®å‰çš„é—®é¢˜ï¼šå¯ä»¥ä¸Šä¼ è§†é¢‘ç­‰èµ„æº

å¦‚æœä»€ä¹ˆéƒ½å¯ä»¥ä¸Šä¼ ï¼Œè€Œä¸”ä¸Šä¼ å†…å®¹çš„å¤§å°ä¹Ÿä¸é™åˆ¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå…è´¹çš„å­˜å‚¨ç©ºé—´å¾ˆå®¹æ˜“å°±æ»¡äº†â€¦â€¦

æˆ‘ä»¬è¦åšçš„ï¼š

1. é™åˆ¶æ–‡ä»¶çš„ç±»å‹
3. é™åˆ¶æ–‡ä»¶çš„å¤§å°

ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼š[åŠ è½½ä¸­ Spin - Ant Design](https://ant.design/components/spin-cn/)

ä¸Šä¼ é™åˆ¶ï¼š

![ä¸Šä¼ é™åˆ¶](assets/img/2021-04-13-17-10-25.png)

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-04-13-17-14-58.png)

![æ•ˆæœ](assets/img/2021-04-13-17-16-20.png)

---

åŠ è½½æç¤ºï¼š

![åŠ è½½æç¤º](assets/img/2021-04-13-17-13-47.png)

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-04-13-17-17-33.png)

2ï¼‰ä¸Šä¼ å†å²æ•°æ®æŸ¥è¯¢æ¥å£

æ•°æ®éƒ½åœ¨ Leancloud çš„ Image é‡Œè¾¹ï¼š

![æ•°æ®ä½ç½®](assets/img/2021-04-13-17-38-23.png)

æˆ‘ä»¬è¦åšçš„ï¼š

1. æŸ¥è¯¢æ•°æ®
2. å±•ç¤ºæ•°æ®

> CRUD ä¹‹ æŸ¥è¯¢æ“ä½œï¼

---

æ‰§è¡Œä¸€æ¬¡åŸºç¡€æŸ¥è¯¢é€šå¸¸åŒ…æ‹¬è¿™äº›æ­¥éª¤ï¼š

1. æ„å»º `AV.Query`ï¼›
2. å‘å…¶æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼›
3. æ‰§è¡ŒæŸ¥è¯¢å¹¶è·å–åŒ…å«æ»¡è¶³æ¡ä»¶çš„å¯¹è±¡çš„æ•°ç»„ã€‚

ä»£ç ï¼š

![ä»£ç ](assets/img/2021-04-13-18-24-40.png)

- includeï¼šè·å–æ¥è‡ªå¦ä¸€ä¸ª`class`çš„æ•°æ®ï¼Œå¦‚`_User`
- limitï¼šé™åˆ¶è¿”å›ç»“æœçš„æ•°é‡ï¼ˆé»˜è®¤ä¸º `100`ï¼‰ï¼Œå¦‚`query.limit(10)`ï¼Œè¡¨ç¤ºã€Œåªè·å– 10 æ¡ã€
- skipï¼šè·³è¿‡å‰`page*limit`æ¡ç»“æœ
- descendingï¼šæŒ‰ `createdAt` é™åºæ’åˆ—
- ascendingï¼šæŒ‰ `createdAt` å‡åºæ’åˆ—
- equalToï¼šè·å–æ‰€æœ‰`owner`ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„`Image`

> æ³¨æ„ï¼š`skip` çš„å€¼è¶Šé«˜ï¼ŒæŸ¥è¯¢æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `createdAt` æˆ– `updatedAt` çš„èŒƒå›´æ¥å®ç°æ›´é«˜æ•ˆçš„ç¿»é¡µï¼Œå› ä¸ºå®ƒä»¬éƒ½è‡ªå¸¦ç´¢å¼•ã€‚

3ï¼‰ä¸Šä¼ å†å²å…¨å±€çŠ¶æ€ç®¡ç†

``` js
import { observable, action, makeObservable } from "mobx";
import { Uploader } from "../models";
import { message } from "antd";

class HistoryStore {
  constructor() {
    makeObservable(this);
  }
  @observable list = [];
  @observable isLoading = false;
  @observable hasMore = true;
  @observable page = 0;
  limit = 10;

  @action append(newList) {
    this.list = this.list.concat(newList);
  }

  @action find() {
    this.isLoading = true;
    Uploader.find({ page: this.page, limit: this.limit })
      .then((newList) => {
        this.append(newList);
        if (newList.length < this.limit) {
          this.hasMore = false;
        }
      })
      .catch((error) => {
        message.error("åŠ è½½æ•°æ®å¤±è´¥", error);
      })
      .finally(() => {
        this.isLoading = false;
      });
  }
}

export default new HistoryStore();
```

4ï¼‰åŠ è½½æ›´å¤šçš„å®ç° & åˆ—è¡¨æ•°æ®å±•ç°

![åˆ—è¡¨æ•°æ®å±•ç°](assets/img/2021-04-13-19-55-45.png)

5ï¼‰äº§å“å®Œç»“








