### âœï¸ Tangxt â³ 2021-04-07 ğŸ·ï¸ epic

# 02-antdã€leancloud ç™»å½•æ³¨å†Œã€mobx

### <mark>1ï¼‰antd çš„å¼•å…¥å’ŒåŸºæœ¬ä½¿ç”¨</mark>

#### <mark>1ã€å¿«é€Ÿä¸Šæ‰‹</mark>

å®‰è£…ï¼š

``` bash
yarn add antd
```

åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼ŒæŠ¥é”™äº†ï¼š `Timeout error on yarn install with https://registry.npm.taobao.o rg/date-fns/download/date-fns-2.19.0.tgz`

å¦‚ä½•è§£å†³ï¼Ÿ

``` bash
yarn config set network-timeout 300000
```

é…ç½®ä¸€ä¸‹ç½‘ç»œè¶…æ—¶çš„æ—¶é—´å°±å¥½äº†ï¼

é‡åˆ° `ESOCKETTIMEDOUT` è¿™æ ·çš„é”™è¯¯éƒ½å¯ä»¥è¿™æ ·åšï¼

ä½¿ç”¨ï¼š

åœ¨ `src/App.js` é‡Œè¾¹ä½¿ç”¨ `Button` ç»„ä»¶ï¼š

* `import { Button } from "antd";`
* `<Button type="primary">Button</Button>`

åœ¨ `src/App.css` çš„é¡¶éƒ¨å¼•å…¥æ ·å¼ï¼š

* `@import '~antd/dist/antd.css';`

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ `src/index.js` é‡Œè¾¹å¯¼å…¥æ ·å¼ï¼š `import "antd/dist/antd.css"`

æ•ˆæœï¼š

![Button](assets/img/2021-04-07-15-24-30.png)

#### <mark>2ã€CRM å¤§æ³•ï¼Œå®Œæˆæˆ‘ä»¬çš„éœ€æ±‚</mark>

![ä»£ç ](assets/img/2021-04-07-15-49-45.png)

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-04-07-15-52-06.png)

### <mark>2ï¼‰å¼•å…¥ antd çš„ form è¡¨å•å®ç°æ³¨å†Œé¡µé¢</mark>

![æ³¨å†Œé¡µé¢](assets/img/2021-04-07-19-22-58.png)

ğŸ’¡ï¼šè¿™ä¸ªæ˜¯ä»€ä¹ˆè¯­æ³•ï¼Ÿ

![è¯­æ³•](assets/img/2021-04-07-17-14-13.png)

``` js
const layout = {
  labelCol: {
    span: 8
  },
  wrapperCol: {
    span: 16
  },
};
```

React æ”¯æŒè¿™ç§å†™æ³•å—ï¼Ÿè¿˜æ˜¯è¯´è¿™æ˜¯ç”¨äº†å…¶å®ƒæ’ä»¶åšåˆ°çš„ï¼Ÿ

- è¿™ä¸ªè¯­æ³•çš„ç›®çš„ï¼šæ–¹ä¾¿æ‹“å±•æˆ‘ä»¬çš„å±æ€§ï¼Œä¸ç„¶ï¼Œè‡ªå·±è¿˜å¾—ä¸€ä¸ªä¸ªå†™ï¼Œå°±å¾ˆä¸åŠ¨æ€äº†
- åœ¨ JSX é‡Œè¾¹çš„è¿™ä¸ª`...`è¿ç®—ç¬¦ï¼Œè¡¨ç¤ºçš„æ˜¯å°†ä¸€ä¸ªå¯¹è±¡çš„é”®å€¼å¯¹ä¸ `ReactElement` çš„ `props` å±æ€§åˆå¹¶ -> React ä¼šå¸®æˆ‘ä»¬æ‹·è´åˆ°ç»„ä»¶çš„ `props` å±æ€§ä¸­ï¼Œæ€»ä¹‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”± React æ“æ§çš„
- å¯ç†è§£æˆï¼š`<Component labelCol={xxx} wrapperCol={yyy} />`
- æ³¨æ„ï¼šå¦‚æœç”¨åˆ°äº†åŒåå±æ€§ï¼Œåè€…å°†è¦†ç›–å‰è€…ï¼Œå¦‚`<Component {...layout} labelCol={zzz} />`
- æœ¬è´¨ï¼šbabel è¯†åˆ«å®ƒï¼Œè½¬åŒ–æˆ AST çš„ä¸€ä»½å­ï¼Œå…¶ç±»å‹æ˜¯`JSXSpreadAttribute`

â¹ï¼š[react ä¸­çš„è§£æ„èµ‹å€¼ä¾‹å­_lskshz çš„ä¸“æ -CSDN åšå®¢_react è§£æ„](https://blog.csdn.net/lskshz/article/details/72568882)

â¹ï¼š[React.js ç»™ç»„ä»¶å±æ€§èµ‹å€¼çš„å±•å¼€è¿ç®—ç¬¦åº”è¯¥æ€ä¹ˆç†è§£ï¼Ÿ- SegmentFault æ€å¦](https://segmentfault.com/q/1010000015225190)

### <mark>3ï¼‰antd è¡¨å•éªŒè¯çš„å‡ ç§æ–¹</mark>

> æ–‡æ¡£ï¼š[è¡¨å• Form - Ant Design](https://ant.design/components/form-cn/#Rule)

Rule æ”¯æŒæ¥æ”¶ object è¿›è¡Œé…ç½®ï¼Œä¹Ÿæ”¯æŒ function æ¥åŠ¨æ€è·å– form çš„æ•°æ®ï¼š

``` ts
type Rule = RuleConfig | ((form: FormInstance) => RuleConfig);
```

- `rules`å‚æ•° -> æ˜¯ä¸ªæ•°ç»„ -> ç”¨äºæ ¡éªŒè§„åˆ™ï¼Œè®¾ç½®å­—æ®µçš„æ ¡éªŒé€»è¾‘
  - æ•°ç»„é‡Œè¾¹çš„å…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªä¸ªæ™®é€šå¯¹è±¡æˆ–è€…ä¸€ä¸ªä¸ªå‡½æ•°ï¼Œå¦‚æœæ˜¯å¯¹è±¡å€¼ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼Œå¦‚`required`ã€`message`ã€`min`ã€`max`ã€`validator`ç­‰éƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼

å¯¹äºæ³¨å†Œé¡µé¢ï¼š

#### <mark>1ã€ç”¨æˆ·åè¾“å…¥æ¡†æ ¡éªŒ</mark>

``` js
const validateUserName = (rule, value) => {
  if (/\W/.test(value)) return Promise.reject("åªèƒ½æ˜¯å­—æ¯æ•°å­—ä¸‹åˆ’çº¿");
  if (value.length < 4 || value.length > 10) return Promise.reject("é•¿åº¦ä¸º 4~10 ä¸ªå­—ç¬¦");
  return Promise.resolve();
};
```

![ç”¨æˆ·åæ ¡éªŒ](assets/img/2021-04-07-19-56-27.png)

- validatorï¼šè‡ªå®šä¹‰æ ¡éªŒï¼Œæ¥æ”¶ Promise ä½œä¸ºè¿”å›å€¼ -> `(rule, value) => Promise`
- requiredï¼šæ˜¯å¦ä¸ºå¿…é€‰å­—æ®µ -> `Boolean` -> ä½ è®¾å®ƒä¸º`true`ï¼Œé‚£ã€Œç”¨æˆ·åã€æ—è¾¹å°±æœ‰ä¸€ä¸ªçº¢è‰²çš„`*`ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™ä¸ª`*`ä¹Ÿæ˜¯ä¸€ç§æç¤ºï¼

#### <mark>2ã€å¯†ç è¾“å…¥æ¡†æ ¡éªŒ</mark>

![å¯†ç æ ¡éªŒ](assets/img/2021-04-07-20-09-57.png)

#### <mark>3ã€ç¡®è®¤å¯†ç è¾“å…¥æ¡†æ ¡éªŒ</mark>

``` js
const validateConfirm = ({ getFieldValue }) => ({
  validator(rule, value) {
    if (getFieldValue("password") === value) return Promise.resolve();
    return Promise.reject("ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´");
  },
});
```

`{ getFieldValue }`æ˜¯ Form å®ä¾‹ï¼Œæˆ‘ä»¬æ‹¿åˆ°å®ä¾‹çš„`getFieldValue`æ–¹æ³•ï¼Œè€Œç®­å¤´å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯`RuleConfig`ï¼Œè¿™å°±åƒä¸Šè¾¹çš„`{validator: validateUserName}`ä¸€æ ·

![ç¡®è®¤å¯†ç æ ¡éªŒ](assets/img/2021-04-07-22-39-46.png)

### <mark>4ï¼‰Leancloud ä½¿ç”¨ä»‹ç»</mark>

#### <mark>1ã€ä»‹ç»</mark>

ä½¿ç”¨ä¸€ä¸ª Serverless å¹³å°ï¼ -> ä¸ç”¨è‡ªå·±å»å†™åç«¯ä»£ç ï¼Œå°±èƒ½æä¾›åç«¯æœåŠ¡ï¼

æˆ‘ä»¬åªè¦è°ƒç”¨å®ƒæä¾›çš„å‰ç«¯ APIï¼Œå°±èƒ½ä½¿ç”¨å®ƒæä¾›çš„åç«¯æœåŠ¡äº†ï¼

é€‚ç”¨åœºæ™¯ï¼š

- ä¸€ä¸ªå…¬å¸çš„å°äº§å“
- ä¸ªäººé¡¹ç›®

å¦‚æœé¡¹ç›®ç‰¹åˆ«å¤æ‚ -> å»ºè®®è‡ªå·±å»å†™åç«¯ä»£ç ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Leancloud

#### <mark>2ã€å¿«é€Ÿå…¥é—¨</mark>

> æ–‡æ¡£ï¼š[æ•°æ®å­˜å‚¨å¼€å‘æŒ‡å— Â· JavaScript - LeanCloud æ–‡æ¡£](https://leancloud.cn/docs/leanstorage_guide-js.html#hash799084270)

å®‰è£…ï¼š

``` bash
yarn add leancloud-storage
```

åˆ›å»º`epic`åº”ç”¨ -> åˆ›å»ºä¸€ä¸ª Classï¼Œå°±æ˜¯åœ¨åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼

â¹ï¼š[ã€å›¾æ–‡æ•™ç¨‹ã€‘å‰ç«¯ä½¿ç”¨äº‘å­˜å‚¨ï¼Œåˆ©ç”¨ LeanCloud ç®¡ç†é¡µé¢æ•°æ® - SegmentFault æ€å¦](https://segmentfault.com/a/1190000021165700)

### <mark>5ï¼‰ä½¿ç”¨ Leancloud å®Œå–„ Auth æ¨¡å‹å®ç°ç™»å½•æ³¨å†Œæ¥å£</mark>

> æ–‡æ¡£ï¼š[ç”¨æˆ·æ³¨å†Œã€ç™»å½•](https://leancloud.cn/docs/leanstorage_guide-js.html#hash954895)

ç™»å½•æ³¨å†Œæ¥å£ï¼š

``` js
import AV, { Query, User } from "leancloud-storage";

// åˆå§‹åŒ–
AV.init({
  appId: "XlO937...",
  appKey: "hcH...",
  serverURL: "https://xxx.lc-cn-n1-shared.com",
});

const Auth = {
  // æ³¨å†Œ
  register(username, password) {
    let user = new User();
    user.setUsername(username);
    user.setPassword(password);
    return new Promise((resolve, reject) => {
      user.signUp().then(
        (loginedUser) => resolve(loginedUser),
        (error) => reject(error)
      );
    });
  },

  // ç™»å½•
  login(username, password) {
    return new Promise((resolve, reject) => {
      User.logIn(username, password).then(
        (loginedUser) => resolve(loginedUser),
        (error) => reject(error)
      );
    });
  },

  // æ³¨é”€
  logout() {
    User.logOut();
  },

  // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  getCurrentUser() {
    return User.current();
  },
};

export { Auth };
```

> æŠŠæ‰€æœ‰çš„å’ŒæœåŠ¡å™¨ç›¸å…³çš„æ“ä½œéƒ½æ”¾åˆ°`models`é‡Œè¾¹ -> å¦‚æœå°±ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œé‚£å°±æä¸€ä¸ª`index.js`å°±å¥½äº†ï¼å¦‚æœè¿˜æœ‰å…¶å®ƒæ¨¡å—ï¼Œå¦‚ç”¨æˆ·ä¸ªäººä¿¡æ¯ã€å‘å¸ƒçš„çŠ¶æ€ã€æ—¥å¿—ç­‰ï¼Œé‚£å°±æå¤šå‡ ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œè¾¹ï¼

ğŸ’¡ï¼šçœ‹æ–‡æ¡£æŠ€å·§ï¼Ÿ

> æ–‡æ¡£ï¼š[JavaScript SDK å®‰è£…æŒ‡å— - LeanCloud æ–‡æ¡£](https://leancloud.cn/docs/sdk_setup-js.html#hash641427453)

![æ–‡æ¡£](assets/img/2021-04-08-13-24-12.png)

ğŸ’¡ï¼šå¦‚ä½•å»æ‰æ§åˆ¶å°é‡Œè¾¹çš„è¿™ä¸ªè­¦å‘Šï¼Ÿ

è­¦å‘Šå‘ç”Ÿçš„åœºæ™¯ï¼šåœ¨è¡¨å•ç»„ä»¶é‡Œè¾¹åˆ é™¤è¾“å…¥çš„å†…å®¹

![è­¦å‘Š](assets/img/2021-04-08-10-57-31.png)

åœ¨`src/index.js`é‡Œè¾¹ï¼š

![åˆ é™¤å¤šä½™çš„ä¸œè¥¿](assets/img/2021-04-08-10-59-01.png)

### <mark>6ï¼‰æ¥å£æ¨¡å‹ã€mobx å…¨å±€çŠ¶æ€ã€ç»„ä»¶é—´çš„æ•°æ®è”åŠ¨</mark>

æ³¨å†ŒåŠŸèƒ½ç”¨åˆ°çš„æ•°æ®è”åŠ¨ï¼š

![æ³¨å†ŒåŠŸèƒ½](assets/img/2021-04-08-12-08-45.png)

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-04-08-12-18-19.png)

> UI å±‚ -> action -> values

models åªç®¡æ•°æ®ï¼Œä¸ç®¡ UIï¼Œstores å¯ä»¥ç®¡ UI å±•ç¤ºï¼

![tips æ¡†](assets/img/2021-04-08-13-34-00.png)

è¿™å°±æ˜¯æˆ‘ä»¬è¿˜è¦`Auth.register(username,password).then()`è¿™æ ·æä¸€å±‚`Promise`çš„åŸå› æ‰€åœ¨äº†ï¼è€Œä¸æ˜¯ï¼Œè®©`models`é‡Œè¾¹çš„ä»£ç å»å¤„ç†å“åº”å›æ¥çš„æ•°æ®ï¼æ€»ä¹‹ï¼Œ`models`åªæ˜¯æ•°æ®çš„æ¬è¿å·¥ç½¢äº†ï¼å½“ç„¶ï¼Œæœ€ç»ˆå“åº”å›æ¥çš„æ•°æ®æ˜¯äº¤ç»™äº† UI å±‚å»å¤„ç†äº†ï¼Œè€Œ`store`åªæ˜¯å¤„ç†äº†ä¸€ä¸ªè¿‡æ¸¡ç½¢äº†ï¼Œå¦‚æç¤ºã€è¿‡æ¸¡åŠ¨ç”»ç­‰â€¦â€¦æ•´ä½“ä¸Šçœ‹ï¼š**Mï¼ˆå‘è¯·æ±‚æ‹¿å“åº”æ•°æ®ï¼‰ -> Cï¼ˆæŠŠ Model æ•°æ®ä¼ ç»™ Viewï¼ŒæœŸé—´å¯ä»¥æä¸€äº›è¾…åŠ©çš„ UIï¼Œå¦‚è¿‡æ¸¡åŠ¨ç”»ã€æç¤ºæ¡†ç­‰ï¼‰ -> Vï¼ˆReact ç»„ä»¶ï¼‰**

æ•°æ®åº“æƒ…å†µï¼š

![æ•°æ®åº“æƒ…å†µ](assets/img/2021-04-08-12-19-52.png)

æ³¨å†ŒåŒä¸€ä¸ªç”¨æˆ·åï¼š

![ç”¨æˆ·åå·²å­˜åœ¨](assets/img/2021-04-08-12-21-55.png)

---

ç™»å½•åŠŸèƒ½æ•ˆæœï¼š

![ç™»å½•åŠŸèƒ½æ•ˆæœ](assets/img/2021-04-08-18-01-40.png)

### <mark>7ï¼‰ç™»å½•æ³¨å†ŒåŠŸèƒ½å®Œå–„</mark>

![ç™»å½•æ³¨å†ŒåŠŸèƒ½](assets/img/2021-04-09-01-46-56.png)

ğŸ’¡ï¼šå…³äºæ¨¡å—çš„å¯¼å…¥å¯¼å‡ºï¼Ÿ

å¦‚æœä½ è¿™æ ·å†™ï¼š

``` js
export const useStores = () => useContext(context) 
```

> ä¸èƒ½ç›´æ¥å¯¼å‡ºä¸€ä¸ªå˜é‡ï¼Œå¾—å¯¼å‡ºä¸€ä¸ªå¸¦å£°æ˜çš„å˜é‡

é‚£ä¹ˆå…¶å®ƒæ¨¡å—ç”¨çš„æ—¶å€™å¾—è¿™æ ·ï¼š

``` js
import { useStores } from "../stores";
```

ğŸ’¡ï¼šæœ‰ä¸¤ä¸ªæ¨¡å—ï¼Œéƒ½å¯¼å…¥äº†åŒä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å—æ˜¯ä¸€æ ·çš„å—ï¼Ÿ

![ä¸€æ ·çš„å—](assets/img/2021-04-09-01-49-16.png)

> å›¾è¯¯ï¼š`userStore.js` -> `user.js`

æµ‹è¯•ç»“æœï¼š`window.x === window.b // true`
