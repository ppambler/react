### ✍️ Tangxt ⏳ 2021-04-07 🏷️ epic

# 02-antd、leancloud 登录注册、mobx

1）antd 的引入和基本使用

1、快速上手

安装：

``` bash
yarn add antd
```

在安装过程中，报错了： `Timeout error on yarn install with https://registry.npm.taobao.o rg/date-fns/download/date-fns-2.19.0.tgz`

如何解决？

``` bash
yarn config set network-timeout 300000
```

配置一下网络超时的时间就好了！

遇到 `ESOCKETTIMEDOUT` 这样的错误都可以这样做！

使用：

在 `src/App.js` 里边使用 `Button` 组件：

* `import { Button } from "antd";`
* `<Button type="primary">Button</Button>`

在 `src/App.css` 的顶部引入样式：

* `@import '~antd/dist/antd.css';`

当然，也可以在 `src/index.js` 里边样式： `import "antd/dist/antd.css"`

效果：

![Button](assets/img/2021-04-07-15-24-30.png)

2、CRM 大法，完成我们的需求

![代码](assets/img/2021-04-07-15-49-45.png)

效果：

![效果](assets/img/2021-04-07-15-52-06.png)

2）引入 antd 的 form 表单实现注册页面

![注册页面](assets/img/2021-04-07-19-22-58.png)

💡：这个是什么语法？

![语法](assets/img/2021-04-07-17-14-13.png)

``` js
const layout = {
  labelCol: {
    span: 8
  },
  wrapperCol: {
    span: 16
  },
};
```

React 支持这种写法吗？还是说这是用了其它插件做到的？

- 这个语法的目的：方便拓展我们的属性，不然，自己还得一个个写，就很不动态了
- 在 JSX 里边的这个`...`运算符，表示的是将一个对象的键值对与 `ReactElement` 的 `props` 属性合并 -> React 会帮我们拷贝到组件的 `props` 属性中，总之，这个过程是由 React 操控的
- 可理解成：<Component labelCol={xxx} wrapperCol={yyy} />
- 注意：如果用到了同名属性，后者将覆盖前者，如`<Component {...layout} labelCol={zzz} />`
- 本质：babel 识别它，转化成 AST 的一份子，其类型是`JSXSpreadAttribute`

➹：[react 中的解构赋值例子_lskshz 的专栏-CSDN 博客_react 解构](https://blog.csdn.net/lskshz/article/details/72568882)

➹：[React.js 给组件属性赋值的展开运算符应该怎么理解？- SegmentFault 思否](https://segmentfault.com/q/1010000015225190)

3）antd 表单验证的几种方

> 文档：[表单 Form - Ant Design](https://ant.design/components/form-cn/#Rule)

Rule 支持接收 object 进行配置，也支持 function 来动态获取 form 的数据：

``` ts
type Rule = RuleConfig | ((form: FormInstance) => RuleConfig);
```

- `rules`参数 -> 是个数组 -> 用于校验规则，设置字段的校验逻辑
  - 数组里边的元素，是一个个普通对象或者一个个函数，如果是对象值，那么这些对象的每个属性，如`required`、`message`、`min`、`max`、`validator`等都是有意义的！

对于注册页面：

1、用户名输入框校验

``` js
const validateUserName = (rule, value) => {
  if (/\W/.test(value)) return Promise.reject("只能是字母数字下划线");
  if (value.length < 4 || value.length > 10) return Promise.reject("长度为 4~10 个字符");
  return Promise.resolve();
};
```

![用户名校验](assets/img/2021-04-07-19-56-27.png)

- validator：自定义校验，接收 Promise 作为返回值 -> `(rule, value) => Promise`
- required：是否为必选字段 -> `Boolean` -> 你设它为`true`，那「用户名」旁边就有一个红色的`*`，本质上来说，这个`*`也是一种提示！

2、密码输入框校验

![密码校验](assets/img/2021-04-07-20-09-57.png)

3、确认密码输入框校验

``` js
const validateConfirm = ({ getFieldValue }) => ({
  validator(rule, value) {
    if (getFieldValue("password") === value) return Promise.resolve();
    return Promise.reject("两次密码不一致");
  },
});
```

`{ getFieldValue }`是 Form 实例，我们拿到实例的`getFieldValue`方法，而箭头函数的返回值就是`RuleConfig`，这就像上边的`{validator: validateUserName}`一样

![确认密码校验](assets/img/2021-04-07-22-39-46.png)

4）Leancloud 使用介绍

1、介绍

使用一个 Serverless 平台！ -> 不用自己去写后端代码，就能提供后端服务！

我们只要调用它提供的前端 API，就能使用它提供的后端服务了！

适用场景：

- 一个公司的小产品
- 个人项目

如果项目特别复杂 -> 建议自己去写后端代码，而不是使用 Leancloud

2、快速入门

> 文档：[数据存储开发指南 · JavaScript - LeanCloud 文档](https://leancloud.cn/docs/leanstorage_guide-js.html#hash799084270)

安装：

``` bash
yarn add leancloud-storage
```

创建`epic`应用 -> 创建一个 Class，就是在创建一个数据库！

➹：[【图文教程】前端使用云存储，利用LeanCloud管理页面数据 - SegmentFault 思否](https://segmentfault.com/a/1190000021165700)


5）使用 Leancloud 完善 Auth 模型实现登录注册接口
