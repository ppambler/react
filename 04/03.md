### âœï¸ Tangxt â³ 2021-03-21 ğŸ·ï¸ ç±»ç»„ä»¶

# Class ç»„ä»¶è¯¦è§£

## â˜…è‹±è¯­å°è¯¾å ‚

![è‹±è¯­å°è¯¾å ‚](assets/img/2021-03-21-12-55-14.png)

## ä¸¤ç§åˆ›å»º Class ç»„ä»¶çš„æ–¹å¼

1ï¼‰ES5 æ–¹å¼ï¼ˆè¿‡æ—¶ï¼‰

![ES5](assets/img/2021-03-21-12-57-23.png)

2ï¼‰ES6 æ–¹å¼

![ES6](assets/img/2021-03-21-13-00-16.png)

3ï¼‰å“ªç§å¥½

![å“ªç§å¥½](assets/img/2021-03-21-13-01-21.png)

## â˜…Propsï¼ˆå¤–éƒ¨æ•°æ®ï¼‰

1ï¼‰props

å¤–éƒ¨æ•°æ®ä¸€èˆ¬éƒ½æ˜¯æ¥è‡ªçˆ¶å…ƒç´ çš„å†…éƒ¨æ•°æ®ï¼š

![å¤–éƒ¨æ•°æ®](assets/img/2021-03-21-17-55-13.png)

åˆå§‹åŒ–ï¼š

![åˆå§‹åŒ–](assets/img/2021-03-21-17-57-13.png)

2ï¼‰å­ç»„ä»¶è¯»å– props

![è¯»å–](assets/img/2021-03-21-17-59-31.png)

3ï¼‰è°å†™ props

![å†™ props](assets/img/2021-03-21-18-00-48.png)

è®©`props`çš„**ä¸»äºº**å¯¹æ•°æ®è¿›è¡Œæ›´æ”¹ï¼š

![å†™ props](assets/img/2021-03-21-18-04-11.png)

4ï¼‰ç›¸å…³é’©å­

![componentWillReceiveProps](assets/img/2021-03-21-18-05-42.png)

``` jsx
import "./styles.css";
import React from "react";

export default class App extends React.Component {
  constructor() {
    super();
    this.state = {
      n: 0
    };
  }
  onClick = () => {
    this.setState({
      n: this.state.n + 1
    });
  };
  render() {
    return (
      <div className="App">
        App <button onClick={this.onClick}>+1</button>
        <B name={this.state.n}>
          <h1>1</h1>
          <h2>2</h2>
        </B>
      </div>
    );
  }
}

class B extends React.Component {
  // constructor(props) {
  //   super(props);
  //   console.log(props);
  // }
  componentWillReceiveProps(newProps, nextContext) {
    console.log("æ—§çš„ props");
    console.log(this.props);
    console.log("props å˜åŒ–äº†");
    console.log("æ–°çš„ props");
    console.log(newProps);
  }
  render() {
    return (
      <div>
        {this.props.name}
        <div>{this.props.children}</div>
      </div>
    );
  }
} //é€šè¿‡ this.props.xxx è¯»å–
```

![componentWillReceiveProps](assets/img/2021-03-22-19-08-26.png)

> è¯¥é’©å­çš„ä½œç”¨å°±æ˜¯ã€Œé€šçŸ¥ä½  `props` ä»€ä¹ˆæ—¶å€™å˜åŒ–ã€

æ³¨æ„ï¼Œ`componentWillReceiveProps`é’©å­å·²è¢«å¼ƒç”¨ -> è¯·ä¸è¦ä½¿ç”¨ï¼

![çœ‹æ‡‚æ—§ä»£ç ](assets/img/2021-03-22-19-11-22.png)

ğŸ’¡ï¼šä¸ºä»€ä¹ˆè¦ä¹ˆä¸å†™`constructor`ï¼Œè¦ä¹ˆå†™å…¨`constructor`ï¼Ÿæˆ‘æ²¡æœ‰å†™`constructor`ï¼Œè€Œæˆ‘åœ¨ JSX æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨`this.props`æ‹¿åˆ°å¤–éƒ¨å¯¹è±¡çš„ï¼Ÿ

å¦‚æœä½ ä¸å†™ `constructor`ï¼Œé‚£ä¹ˆ React å†…éƒ¨ï¼Œä¼šåœ¨ç»„ä»¶å®ä¾‹åŒ–åï¼Œæ‰§è¡Œè¿™è¡Œä»£ç ï¼š

``` js
// React å†…éƒ¨
const instance = new YourComponent(props);
instance.props = props;
```

â¹ï¼š[è¯‘-æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å†™ super(props)?](https://juejin.cn/post/6844903729980768269)

5ï¼‰props çš„ ä½œç”¨

![ä½œç”¨](assets/img/2021-03-22-19-18-25.png)

## â˜…Stateï¼ˆå†…éƒ¨æ•°æ®ï¼‰

![state](assets/img/2021-03-22-19-45-41.png)

1ï¼‰åˆå§‹åŒ– State

![init State](assets/img/2021-03-22-19-59-36.png)

2ï¼‰è¯»å†™ State

![è¯»å†™ State](assets/img/2021-03-22-20-05-02.png)

ä¸å®ˆè§„çŸ©çš„å†™ Stateï¼š

![ä¸å®ˆè§„çŸ©](assets/img/2021-03-22-22-15-34.png)

3ï¼‰setState ç¬¬ä¸€ä¸ªå‚æ•°ç”¨å¯¹è±¡å’Œå‡½æ•°çš„åŒºåˆ«

éœ€æ±‚ï¼šä¸¤æ¬¡ setState

![ä¸¤æ¬¡ setState](assets/img/2021-03-22-20-18-52.png)

> `this.state.x`åœ¨è¯»çš„æ—¶å€™ï¼Œè¿˜æ˜¯æ—§çš„`x`å€¼

![æ—§å€¼](assets/img/2021-03-22-20-22-08.png)

> ä¹‹å‰è¯´è¿‡äº†ï¼Œå‡½æ•°å¯ä»¥å»¶è¿Ÿæ±‚å€¼ï¼Œè€Œè¿™ä¸ª `this.state.x` æ˜¯å…ˆç¡®å®šäº†å€¼å†ç»™`setState`çš„ï¼ -> ç¬¬ä¸€ä¸ª`setState`æ‰§è¡Œåï¼Œ`x`å¹¶å’©æœ‰å˜åŒ–ï¼Œè¿˜æ˜¯åŸæ¥çš„`1`ï¼Œå½“æ‰§è¡Œåˆ°ç¬¬äºŒä¸ª`setState`ï¼Œ`this.state.x`çš„å€¼ä¾æ—§æ˜¯`1`

æ‰€ä»¥ï¼Œå¦‚ä½•è®©ä¸¤æ¬¡`setState`çš„ç»“æœæ˜¯ä¸¤æ¬¡`+1`å‘¢ï¼Ÿ

ä¸‰ç§å§¿åŠ¿ï¼š

1. ä¸€æ¬¡è®¡ç®—å¥½äº†å†å†™`setState` -> è¿™æ ·å°±åªå†™ä¸€æ¬¡`setState`äº†
2. ä½¿ç”¨`setTimeout()=>{ two setState }` -> åœ¨ callback é‡Œè¾¹å†™ä¸¤æ¬¡ `setState`
3. ç”¨å‡½æ•° -> æ»¡è¶³ä½ å†™ä¸¤æ¬¡`setState`çš„éœ€æ±‚

ç”¨å®šæ—¶å™¨ï¼š

![å®šæ—¶å™¨](assets/img/2021-03-22-21-23-38.png)

> è¿™ç§å§¿åŠ¿çš„`setState`çœ‹ä¸Šå»å°±åƒåŒæ­¥äº†ï¼ -> å¦‚æœä¸åŠ `setTimeout`å°±æ˜¯å¼‚æ­¥äº†ï¼ -> æ€»ä¹‹ï¼Œ`setState`æœ¬è´¨è¿˜æ˜¯å¼‚æ­¥çš„ï¼

ç”¨å‡½æ•°å‚æ•°ï¼š

![ç”¨å‡½æ•°](assets/img/2021-03-22-20-29-15.png)

å…¶å®è¿˜å¯ä»¥ç”¨`setState`çš„ç¬¬äºŒä¸ªå‚æ•°æ¥æï¼ˆå°‘ç”¨ï¼‰ï¼š

![ä½¿ç”¨ callback](assets/img/2021-03-22-22-24-49.png)

ğŸ’¡ï¼šä¸ºä»€ä¹ˆè¦å¤šæ¬¡`setState`ï¼Ÿ

å› ä¸ºè¿™ä¸ª Web åº”ç”¨ç¨‹åºå˜å¤æ‚äº†ï¼Œæ‰€ä»¥å¤šæ¬¡ `setState` å°±å¯èƒ½å‡ºç°äº†ï¼

ç„¶è€Œä¸€ä¸ª`setState`å°±æ„å‘³ç€ä¸€æ¬¡`render`ï¼Ÿå³ DOM è§†å›¾ä¼šç«‹åˆ»å‘ç”Ÿå˜åŒ–å—ï¼Ÿ -> ä¸ -> è¿™æ˜¯ã€Œbatches updatesã€ï¼Œä¹Ÿå°±æ˜¯å…ˆæŠŠä½ è¦æ›´æ–°çš„è¯´æ¸…æ¥šï¼Œå†ä¸€æ¬¡æ€§å»`render` -> ç±»ä¼¼äºï¼Œä½ è¦ä¹° 10 ä¸ªè‹¹æœï¼Œä½†ä½ å´ä¸€ä¸ªè¢‹å­è£…ä¸€ä¸ªè¿™æ ·å»ç»“è´¦ï¼Œç»“è´¦äº† 10 æ¬¡ï¼ -> ä¸ºä½•ä¸ 10 ä¸ªè£…åœ¨ä¸€èµ·ï¼Œå†ä¸€æ¬¡æ€§ç»“è´¦å‘¢ï¼Ÿ

ä¸ºä»€ä¹ˆè¦ç”¨å‡½æ•°å‚æ•°ï¼Ÿ -> æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸Šä¸€æ¬¡`setState`çš„ç»“æœï¼

ç±»æ¯”ã€Œç‹ç‰Œå¯¹ç‹ç‰Œï¼šä¼ å£°ç­’ä¼ è¯æ¸¸æˆã€:

![setState](assets/img/2021-03-22-21-16-37.png)

ğŸ’¡ï¼šä¸ºä»€ä¹ˆç”¨äº†å‡½æ•°å‚æ•°åï¼Œç¬¬äºŒä¸ª`setState`çš„`state`å€¼å°±æ˜¯ä¸Šä¸€ä¸ª`setState`æ›´æ–°åçš„å€¼ï¼Ÿ

â¹ï¼š[è¯‘ - åœ¨ setState ä¸­ä½¿ç”¨å‡½æ•°æ›¿ä»£å¯¹è±¡](https://juejin.cn/post/6844903459842424839)

ğŸ’¡ï¼š`setState`çš„æºç ï¼Ÿ

``` js
ReactComponent.prototype.setState = function(partialState, callback) {
  this.updater.enqueueSetState(this, partialState);
  if (callback) {
    this.updater.enqueueCallback(this, callback, 'setState');
  }
};
```

`partialState` -> éƒ¨åˆ†`state` -> è¡¨ç¤ºã€Œä¸å½±å“å…¶å®ƒçš„`state`ï¼Œåªæ›´æ–°æˆ‘è¦æ›´æ–°çš„ã€

â¹ï¼š[React - setState æºç åˆ†æï¼ˆå°ç™½å¯è¯»ï¼‰](https://juejin.cn/post/6844903573453537287)

## â˜…ç”Ÿå‘½å‘¨æœŸ

1ï¼‰æ¦‚è¿°

åŸç”Ÿ JS é‡Œè¾¹çš„ç”Ÿå‘½å‘¨æœŸï¼š

![ç”Ÿå‘½å‘¨æœŸ](assets/img/2021-03-22-22-28-51.png)

React é‡Œè¾¹çš„ç”Ÿå‘½å‘¨æœŸï¼š

![React](assets/img/2021-03-22-22-31-12.png)

æˆ‘ä»¬å¿…é¡»è¦ä¼šçš„é’©å­ï¼š

![å¿…é¡»è¦ä¼šçš„é’©å­](assets/img/2021-03-22-22-32-08.png)

> `componentWillUnmount` -> ç»„ä»¶å°†è¦æ¶ˆå¤±ï¼

2ï¼‰constructor

![constructor](assets/img/2021-03-22-22-36-34.png)

3ï¼‰shouldComponentUpdate

![shouldComponentUpdate](assets/img/2021-03-23-13-23-14.png)

ä»€ä¹ˆæ—¶å€™è§¦å‘è¿™ä¸ªé’©å­ï¼Ÿ -> `state`å˜äº†å°±è§¦å‘

![ç”¨æ³•](assets/img/2021-03-23-17-49-35.png)

å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç”¨`shouldComponentUpdate`ï¼Œå³ä¾¿`n`çš„å€¼è¿˜æ˜¯åŸæ¥çš„`1`ï¼Œä¹Ÿä¼šæ‰§è¡Œ`render`æ–¹æ³•ï¼Œå› ä¸º`state`å·²ç»å˜äº†ï¼Œ`state`è¿™ä¸ªå¯¹è±¡æ¢äº†ï¼Œé‚£ä¹ˆ React å°±å¾—æ›´æ–°æ•°æ®ï¼Œå½“ç„¶ï¼Œè¿™å¹¶ä¸ä¼šæ›´æ–° UIï¼š

![ä¸æ›´æ–° UI](assets/img/2021-03-23-17-52-58.png)

æ€»ä¹‹ï¼Œä½ ä¸å†™`shouldComponentUpdate`å»å¤„ç†çš„è¯ï¼Œ`render`æ˜¯å¤šæ‰§è¡Œäº†çš„ï¼Œè€Œæˆ‘ä»¬ç”¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯å¯ä»¥é˜»æ­¢å®ƒæ‰§è¡Œçš„ï¼

å¦‚ä½•é˜»æ­¢ï¼Ÿ -> **åˆ¤æ–­æ–°çš„æ—§çš„ç›¸ç­‰å°±ä¸æ‰§è¡Œ**

![æé«˜æ€§èƒ½](assets/img/2021-03-23-17-56-21.png)

ç¤ºä¾‹ä»£ç ï¼š

![ç¤ºä¾‹ä»£ç ](assets/img/2021-03-23-17-57-43.png)

ğŸ’¡ï¼špureComponentï¼Ÿ

å®ƒä¼šåœ¨ `render` ä¹‹å‰å¯¹æ–°æ—§ `state` è¿›è¡Œå¯¹æ¯”ï¼ˆ**æµ…å¯¹æ¯”ï¼Œåªå¯¹æ¯”ä¸€å±‚**ï¼‰

![pureComponent](assets/img/2021-03-23-18-00-45.png)

å¦‚æœä½ å¤šæ­¤ä¸€ä¸¾çš„å†™äº†`shouldComponentUpdate`ï¼Œé‚£ä¹ˆæ§åˆ¶å°å°±ä¼šè­¦å‘Šä½ ï¼š

![ä¸ç”¨å†™](assets/img/2021-03-23-18-01-34.png)

é¢å¯¹è¿™ç§æƒ…å†µï¼š

![è¿™ç§æƒ…å†µ](assets/img/2021-03-23-18-13-35.png)

`pureComponent`ä¹Ÿå°±ä¸å¥½ä½¿äº†ï¼å³`name`ä¾æ—§æ˜¯`frank`ï¼Œè¿˜æ˜¯ä¼šè°ƒç”¨`render`ï¼Œå½“ç„¶ï¼Œè¿™ UI å¹¶ä¸ä¼šæ›´æ–°ï¼

æ€»ä¹‹ï¼š

![æ€»ç»“](assets/img/2021-03-23-18-16-55.png)

4ï¼‰render

å®ƒç»™ React ä½¿ç”¨è€…çš„å°è±¡ï¼š

- å‘Šè¯‰ React ç»„ä»¶æ˜¯é•¿å•¥æ ·çš„
- `return`çš„æ˜¯ä¸€ä¸ª vDOM å¯¹è±¡

![render](assets/img/2021-03-23-18-42-12.png)

1ã€è™šæ‹Ÿ DOM

![vDOM](assets/img/2021-03-23-18-49-52.png)

2ã€React.Frangment

![Frangment](assets/img/2021-03-23-18-52-12.png)

3ã€if else

![if else](assets/img/2021-03-23-19-02-33.png)

å¯ä»¥ç®€å†™æˆä¸‰ç›®è¿ç®—ç¬¦ï¼š

![ä¸‰ç›®è¿ç®—ç¬¦](assets/img/2021-03-23-19-06-16.png)

å¦‚æœä½ æƒ³åªå±•ç¤ºä¸€ç§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç®€å†™æˆ`&&`ï¼š

![&&](assets/img/2021-03-23-19-10-57.png)

4ã€å¾ªç¯

å¦‚æœä½ ç”¨`for`å¾ªç¯ï¼Œä½ è¿™æ ·å†™ï¼š

``` jsx
class() {
  render() {
    for (let index = 0; index < this.state.arr.length; index++) {
      const element = this.state.arr[index];
      return element
    }
  }
}
```

å¾ªç¯ä¸€éå°±ç»“æŸï¼Œå› ä¸º`return`äº†å‘€ï¼

è¿”å›çš„æ˜¯æ•°ç»„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°ç»„å…ƒç´ ï¼š

![æ•°ç»„](assets/img/2021-03-23-19-20-53.png)

> `Warning: Each child in a list should have a unique "key" prop` -> åˆ«å¿˜äº†ï¼Œè¦ä¸ºæ¯ä¸ª react å…ƒç´ åŠ ä¸€ä¸ªå”¯ä¸€çš„`key`å±æ€§

ä½¿ç”¨`map`ï¼ˆ**æ›´é«˜çº§**ï¼‰ï¼Œè€Œä¸æ˜¯`for`ï¼š

![map](assets/img/2021-03-23-19-28-16.png)

5ï¼‰componentDidMount
