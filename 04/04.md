### âœï¸ Tangxt â³ 2021-03-24 ğŸ·ï¸ å‡½æ•°ç»„ä»¶

# å‡½æ•°ç»„ä»¶

## â˜…å‡½æ•°ç»„ä»¶æ¯” class ç»„ä»¶ç®€å•

### <mark>1ï¼‰å‡½æ•°ç»„ä»¶çš„åˆ›å»ºæ–¹å¼</mark>

![åˆ›å»ºæ–¹å¼](assets/img/2021-03-24-11-46-41.png)

è¯è¯´ï¼Œå‡½æ•°ç»„ä»¶èƒ½æ›¿ä»£ Class ç»„ä»¶å—ï¼Ÿ

![å‡½æ•°ç»„ä»¶](assets/img/2021-03-24-11-47-30.png)

è¿™æ˜¯å®Œå…¨å¯ä»¥çš„ï¼

å¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨å‡½æ•°ç»„ä»¶ä»£æ›¿ Class ç»„ä»¶å‘¢ï¼Ÿ -> **å› ä¸ºç®€æ´å‘€ï¼**

### <mark>2ï¼‰å¯¹æ¯”ç±»ç»„ä»¶å‡½æ•°ç»„ä»¶å®ç° +1</mark>

#### <mark>1ã€class ç»„ä»¶</mark>

![class](assets/img/2021-03-24-12-05-30.png)

#### <mark>2ã€å‡½æ•°ç»„ä»¶</mark>

![å‡½æ•°ç»„ä»¶](assets/img/2021-03-24-12-21-38.png)

#### <mark>3ã€å°ç»“</mark>

å¯¹æ¯”å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶ï¼š

1. class æœ‰`this`
2. å‡½æ•°æ¶ˆé™¤äº† `this`
3. å†™æ³•ä¸Šå‡½æ•°ç®€å•
4. åŠŸèƒ½ä¸Š -> è¯·çœ‹åè¾¹

### <mark>3ï¼‰å‡½æ•°ç»„ä»¶ä»£æ›¿ class ç»„ä»¶</mark>

![ä»£æ›¿ class ç»„ä»¶](assets/img/2021-03-24-11-49-07.png)

> `useEffect`ï¼šå‡½æ•°å¼ç¼–ç¨‹çš„ä¸“æœ‰åè¯ï¼Œä¸»è¦è§£å†³ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼ˆå›ç­”é¢è¯•ï¼šè§£å†³å‰¯ä½œç”¨é—®é¢˜ï¼‰ -> é¢è¯•ä¸€å¥—å›ç­”ï¼Œå¼€å‘ä¸€å¥—å›ç­”ï¼è¿™å¾—çœ‹é¢è¯•å®˜çš„æ°´å¹³å¦‚ä½•ï¼

## â˜…å‡½æ•°ç»„ä»¶æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸ

### <mark>1ï¼‰componentDidMount</mark>

> æ¨¡æ‹Ÿç¬¬ä¸€æ¬¡æ¸²æŸ“

![ç¬¬ä¸€æ¬¡æ¸²æŸ“](assets/img/2021-03-24-14-08-14.png)

æˆ‘ä»¬çŸ¥é“è¿™ä¸ª`componentDidMount`åœ¨ç±»é‡Œè¾¹æ˜¯åªæ‰§è¡Œä¸€æ¬¡çš„

å¦‚æœæˆ‘ä»¬è¿™æ ·æ¨¡æ‹Ÿï¼ˆ**ç›´æ¥å†™**ï¼‰ï¼š

![æ¨¡æ‹Ÿ](assets/img/2021-03-24-14-12-21.png)

> å¦‚æœä½ å†™æˆ`setN(n)`è¿™æ ·ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œ Test7 çš„ï¼Œå› ä¸ºæ•°æ®æ²¡å˜ï¼

å¦‚æœæˆ‘ä»¬ç”¨äº†`userEffect(()=>{})`è¿™æ ·æ¨¡æ‹Ÿï¼Œè¿™è·Ÿã€Œç›´æ¥å†™ã€æ˜¯å·®ä¸å¤šçš„ï¼

![useEffect](assets/img/2021-03-24-14-17-55.png)

ä½†æ˜¯ï¼Œå¦‚æœç»™`useEffect`åŠ äº†ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ**æŒ‡æ˜åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å»è¿è¡Œè¿™ä¸ªå‡½æ•°**ï¼‰ï¼Œå¦‚ç”¨ç©ºæ•°ç»„åšç¬¬äºŒä¸ªå‚æ•°ï¼Œå°±å¯ä»¥æ¨¡æ‹Ÿç¬¬ä¸€æ¬¡æ¸²æŸ“çš„é’©å­ï¼š

``` js
console.log(n)
useEffect(()=>{
  console.log(n)
},[])
```

![åŠ æ•°ç»„](assets/img/2021-03-24-14-20-57.png)

å…³äºè¿™ä¸ªè­¦å‘Šï¼š[reactjs - How to fix missing dependency warning when using useEffect React Hook? - Stack Overflow](https://stackoverflow.com/questions/55840294/how-to-fix-missing-dependency-warning-when-using-useeffect-react-hook)

### <mark>2ï¼‰componentDidUpdateï¼ˆè‡ªå®šä¹‰ Hookï¼‰</mark>

> æ¨¡æ‹Ÿæ•°æ®æ›´æ–°æ‰§è¡Œå‡½æ•°

![æ›´æ–°åæ‰§è¡Œ](assets/img/2021-03-24-14-26-15.png)

- ç¬¬äºŒä¸ªå‚æ•°ï¼šè¡¨ç¤ºä»€ä¹ˆæ•°æ®æ›´æ–°çš„æ—¶å€™æ‰§è¡Œï¼Œå¦‚`n`æ›´æ–°å°±æ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°
- è¿™æ˜¯åŒ…æ‹¬ç¬¬ä¸€æ¬¡ä»`undefined`å˜æˆæœ‰çš„ï¼ -> ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œä¹Ÿç®—æ˜¯ç»„ä»¶å·²ç»æ›´æ–°äº†ï¼

![æ•°ç»„æœ‰å€¼](assets/img/2021-03-24-14-33-37.png)

å¦‚æœå¤šä¸ªæ•°æ®ï¼Œåªæœ‰ç›‘å¬äº†çš„æ•°æ®å˜åŒ–æ‰ä¼šæ‰§è¡Œï¼š

- ä½ åªç›‘å¬äº†`n`ï¼Œå³ç¬¬äºŒä¸ªå‚æ•°æ˜¯`[n]`ï¼Œ`n`å˜äº†ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ‰ä¼šæ‰§è¡Œ
- ä½ ç›‘å¬ä¸¤ä¸ªï¼Œå†™æˆæ•°ç»„`[n,m]`

![ç›‘å¬ä¸¤ä¸ª](assets/img/2021-03-24-14-44-30.png)

å¦‚æœæ˜¯æ‰€æœ‰ `state` æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä¸å†™ï¼Œæ„æ€å°±æ˜¯ä»»ä½•ä¸€ä¸ª `state` å˜åŒ–éƒ½ä¼šæ‰§è¡Œï¼ˆå¼€å§‹çš„é‚£æ ·ï¼Œå³ä¸å¸¦ç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼š

![ç›‘å¬æ‰€æœ‰çš„ state](assets/img/2021-03-24-14-49-32.png)

ğŸ’¡ï¼šè¯è¯´ï¼Œå¦‚ä½•æ¶ˆé™¤ç¬¬ä¸€æ¬¡å˜åŒ–çš„æ‰§è¡Œï¼Ÿ

å§¿åŠ¿ 1ï¼šåŠ ä¸€å±‚`useState`è®¡æ•°

![å§¿åŠ¿ 1](assets/img/2021-03-24-16-50-05.png)

è¿™ç§å§¿åŠ¿å¾ˆéº»çƒ¦ï¼Œè¿˜è¦é¢å¤–å£°æ˜ä¸€ä¸ªä¸œè¥¿ï¼

å§¿åŠ¿ 2ï¼šé€šè¿‡å‡½æ•°ç»„åˆï¼ˆä¸€å®šæ˜¯`use`å¼€å¤´çš„å‡½æ•°åè¿”å›è¿™ä¸ªè®¡æ•°çš„æ•°æ®ï¼‰

![å§¿åŠ¿ 2](assets/img/2021-03-24-18-12-39.png)

æŠŠè¿™ä¸ªä¸œè¥¿ä»å‡½æ•°ç»„ä»¶é‡Œè¾¹æŠ½ç¦»å‡ºæ¥ï¼Œç›´æ¥å°è£…æˆï¼š

![useCount](assets/img/2021-03-24-18-30-08.png)

è¿™ä¸ªåšæ³•ï¼Œç›¸å½“äºé‡å†™äº†ä¸€ä¸ªåŠŸèƒ½æ›´å®Œå–„ï¼ˆ**æ’é™¤ç¬¬ä¸€æ¬¡å˜åŒ–**ï¼‰çš„`useEffect`

ç›®å‰è¿™ä¸ªä»£ç ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼Œçœ‹åˆ°é‚£ä¸ª`â‘¡`æ²¡æœ‰ï¼Ÿè¿™æ„å‘³ç€`fn`å¤šæ¬¡æ‰§è¡Œäº†ï¼š

![è‡ªå®šä¹‰ hooks](assets/img/2021-03-24-18-46-16.png)

ä¸€ä¸ªç–‘é—®ï¼š

![ç–‘é—®](assets/img/2021-03-24-18-55-51.png)

æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™æ˜¯ä»£ç ç¼“å­˜çš„ç¼˜æ•…ï¼Œæˆ‘æŠŠä½¿ç”¨`useUpdate`çš„ç¬¬äºŒä¸ªå‚æ•°æ”¹æˆæ˜¯`[n]`è¿™æ ·ï¼Œå°±å¾—åˆ°äº†æˆ‘æƒ³è¦çš„æ•ˆæœäº†ï¼

ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œä¸¤éï¼Ÿ -> `useUpdate`å®ƒæå¾—é¬¼ï¼

é»˜è®¤çš„`useEffect`ï¼Œä¸ä¼šåœ¨`n`å˜åŒ–çš„æ—¶å€™æ‰§è¡Œä¸¤é`Test8`ï¼š

![useEffect](assets/img/2021-03-24-19-11-47.png)

ç›®å‰çš„é—®é¢˜æ˜¯ï¼š

- `useUpdate`ç›‘å¬`fn`çš„è¯ï¼ˆä¸åŠ è¿™ä¸ªå±…ç„¶ä¼šç»™è­¦å‘Šï¼‰ï¼Œä¼šæ‰§è¡Œä¸¤é`fn`ï¼Œä¸ç›‘å¬åˆ™æ‰§è¡Œä¸€é`fn` -> å¯ä¸ºå•¥ä¼šè¿™æ ·å‘¢ï¼Ÿ
- ä½¿ç”¨äº†`useUpdate`ä¼šæ‰§è¡Œä¸¤é`Test8` -> ä¸ºä»€ä¹ˆä¸åªæ‰§è¡Œä¸€æ¬¡å‘¢ï¼Ÿ -> å¦‚æœæ‰§è¡Œä¸¤éï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶`n`æ²¡å˜ï¼Œä½†`fn`å˜äº†ï¼Œæ‰€ä»¥ä¸è¦ç›‘å¬`fn`ï¼Œè¿™æ ·å°±æ‰§è¡Œäº†ä¸€é`fn`ï¼

ä¸ºä»€ä¹ˆç®¡ç¬¬äºŒä¸ªå‚æ•°å«ã€Œä¾èµ–é¡¹ã€ï¼Ÿ -> å› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦æ‰§è¡Œï¼Œä¾èµ–ç¬¬äºŒé¡¹çš„å˜åŒ–ä¸å¦ï¼

ä¸ºä»€ä¹ˆç¬¬äºŒä¸ªå‚æ•°ä¸º`[]`å°±åªä¼šæ‰§è¡Œä¸€é`fn`ï¼Ÿ -> å› ä¸º`fn`ä¸ä¾èµ–ä»»ä½•å˜é‡ï¼Œæ— è®ºé‚£äº›å˜é‡æ€ä¹ˆå˜ï¼Œ`fn`çš„æ‰§è¡Œç»“æœéƒ½ä¸ä¼šå˜ï¼Œæ—¢ç„¶æ‰§è¡Œç»“æœéƒ½ä¸å˜äº†ï¼Œå†æ‰§è¡Œä¹Ÿå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œæ‰€ä»¥åªæ‰§è¡Œä¸€é`fn`å°±è¶³å¤Ÿäº†ï¼

---

æ‰§è¡Œä¸¤éå¦‚ä½•è§£å†³ï¼Ÿ

æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå…³é—­ä¸¥æ ¼æ¨¡å¼ä¹Ÿæ— æ³•è§£å†³ï¼ -> æ‰“åŒ…åä¹Ÿæ˜¯æ‰§è¡Œä¸¤éï¼

å‚è€ƒï¼š[ä¸ºä»€ä¹ˆ react çš„å‡½æ•°ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ‰§è¡Œä¸¤æ¬¡ï¼Ÿ- çŸ¥ä¹](https://www.zhihu.com/question/387196401)

æ—¢ç„¶æ— æ³•è§£å†³ï¼Œæˆ‘å°±è®¤ä¸ºè¿™ä¸ª`useUpdate`å†™å¾—å¹¶ä¸å¥½ï¼Œäºæ˜¯åœ¨ç½‘ä¸Šåœ¨æ‰¾åˆ°äº†æ¨¡æ‹Ÿ`componentDidUpdate`çš„å¦ä¸€ç§å†™æ³•ï¼š

![å¦ä¸€ç§å†™æ³•](assets/img/2021-03-24-20-38-23.png)

â¹ï¼š[ä½¿ç”¨ React Hooks æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸ](https://juejin.cn/post/6844903921442373639)

---

å¯ä»¥æŠŠ`useUpdate`å°è£…æˆä¸€ä¸ªæ–‡ä»¶ -> è¿™å°±å«åšã€Œ**è‡ªå®šä¹‰ Hook**ã€

![è‡ªå®šä¹‰ hook](assets/img/2021-03-24-20-45-48.png)

`useUpdate`å°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼

### <mark>3ï¼‰componentWillUnmount</mark>

> æ¨¡æ‹Ÿæ¶ˆå¤±

![componentWillUnmount](assets/img/2021-03-24-20-48-00.png)

``` jsx
import React, { useState,useEffect } from "react";

const Fa = () => {
  const [sonVisible, setSonVisible] = useState(true);
  const hide = () => {
    setSonVisible(false);
  };
  const show = () => {
    setSonVisible(true);
  };
  return (
    <div>
      {sonVisible ? (
        <button onClick={hide}>hide</button>
      ) : (
        <button onClick={show}>show</button>
      )}
      {sonVisible ? <Test9/> : null}
    </div>
  );
};

const Test9 = () => {
  const [n, setN] = useState(0);
  const addN = () => {
    setN(n + 1);
  };

  useEffect(() => {
    console.log('Son ç¬¬ä¸€æ¬¡æ¸²æŸ“')
    return () => {
      console.log('ç»„ä»¶ Son è¦æ­»äº†')
    }
  },[])
  console.log(`Son render ç¬¬${n + 1}æ¬¡`);
  return (
    <div>
      n: {n}
      <button onClick={addN}>n+1</button>
    </div>
  );
};

export default Fa;
```

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-03-24-21-09-44.png)

> è¦åŠ `[]`å‚æ•°ï¼Œä¸ç„¶ï¼Œå­ç»„ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‚£ä¸ª `console.log('ç»„ä»¶ Son è¦æ­»äº†')` ä¹Ÿä¼šæ‰§è¡Œï¼

è§£æï¼š

- é»˜è®¤å±•ç¤ºæ—¶ï¼Œä¸ä¼šæ‰§è¡Œè¿™ä¸ª`useEffect`çš„è¿”å›å€¼ï¼Œåªä¼šæ‰§è¡Œ`console.log('Son ç¬¬ä¸€æ¬¡æ¸²æŸ“')`
- éšè—æ—¶ï¼Œä¼šæ‰§è¡Œè¿™ä¸ª`useEffect`çš„è¿”å›å€¼ -> å³åœ¨ç»„ä»¶å°†è¦é”€æ¯å‰æ‰§è¡Œ

---

å¯ä»¥çœ‹åˆ°ï¼ŒReact å®ƒæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯ -> **æ‰€æœ‰ä¸œè¥¿éƒ½å¯ä»¥é€šè¿‡å‡½æ•°ç»„åˆæ¥å®ç°**

### <mark>4ï¼‰å…¶å®ƒç”Ÿå‘½å‘¨æœŸæ€ä¹ˆæ¨¡æ‹Ÿ</mark>

![å…¶å®ƒç”Ÿå‘½å‘¨æœŸçš„æ¨¡æ‹Ÿ](assets/img/2021-03-24-21-15-30.png)

## â˜…äº†è§£æ›´å¤š

â¹ï¼š[è½»æ¾å­¦ä¼š React é’©å­ï¼šä»¥ useEffect() ä¸ºä¾‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2020/09/react-hooks-useeffect-tutorial.html)

â¹ï¼š[React Hooks å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](https://www.ruanyifeng.com/blog/2019/09/react-hooks.html)
