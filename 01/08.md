### âœï¸ Tangxt â³ 2021-02-09 ğŸ·ï¸ Router

# 08-React Router

## â˜…è¯¾ç¨‹ç®€ä»‹

1. ä»€ä¹ˆæ˜¯ Router
2. ä»€ä¹ˆæ˜¯ React Router

æ‰€æœ‰ä»£ç ï¼š<https://codesandbox.io/s/zlop689pr4>

## â˜…ä½¿ç”¨ hash åšè·¯ç”±

> æ–¹æ–¹æ˜¯å¦‚ä½•å­¦ä¹  React Router çš„ï¼Ÿå…ˆæŠŠ React ææ¸…æ¥šï¼Œå†æŠŠ Router ææ¸…æ¥šï¼Œå†å­¦ä¹  React Routerã€‚åƒä¸‡ä¸è¦è¿™ä¸¤ä¸ªä¸œè¥¿éƒ½è¿˜æ²¡ææ¸…æ¥šï¼Œå°±å»å­¦ä¹  React Router äº†ã€‚

### <mark>1ï¼‰ä»€ä¹ˆæ˜¯ Routerï¼Ÿ</mark>

> æœç´¢ã€ŒWiki Routerï¼ˆcomputingï¼‰ã€

è·¯ç”±ï¼ˆroutingï¼‰å°±æ˜¯é€šè¿‡äº’è”çš„ç½‘ç»œæŠŠä¿¡æ¯ï¼ˆ0101ï¼‰ä»æºåœ°å€ä¼ è¾“åˆ°ç›®çš„åœ°å€çš„æ´»åŠ¨ã€‚

> äº’è”çš„ç½‘ç»œå³äº’è”ç½‘ï¼Œç›®å‰æ‰€æœ‰çš„ä¿¡æ¯éƒ½æ˜¯åœ¨äº’è”ç½‘ä¸Šçš„ï¼Œã€Œé€šè¿‡ xxxã€è¿™å¥è¯å°± TM å°±æ˜¯åºŸè¯â€¦â€¦

ç®€è€Œè¨€ä¹‹å°±æ˜¯ã€Œ**ä¿¡æ¯ä»ä¸€ä¸ªåœ°æ–¹åˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„æ´»åŠ¨**ã€

æŠ½è±¡åˆ°å…·ä½“ï¼š

![Router](assets/img/2021-02-10-18-09-33.png)

æŠŠä¸€ä¸ªåœ°æ–¹çš„ä¸œè¥¿ï¼ˆä¿¡æ¯ï¼‰ä¼ åˆ°å®ƒæƒ³å»çš„ç›®çš„åœ°çš„è¿‡ç¨‹å°±å«åšã€Œè·¯ç”±ã€ã€‚

### <mark>2ï¼‰å¯¹äºå‰ç«¯æ¥è¯´ï¼Œè·¯ç”±å®ƒåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</mark>

ä¹Ÿå°±æ˜¯å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼š

![æµè§ˆå™¨è·¯ç”±](assets/img/2021-02-10-20-19-17.png)

> å¦‚æœæŠŠç½‘é¡µçœ‹æˆæ˜¯ä¸€ä¸ªåœ°æ–¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªåœ°å€å°±æ˜¯åˆ°è¿™ä¸ªåœ°æ–¹å»ï¼

### <mark>3ï¼‰ç”¨ä»£ç è§£é‡Šä»€ä¹ˆæ˜¯è·¯ç”±ï¼Ÿ</mark>

éœ€æ±‚ï¼šçŠ¶æ€å˜åŒ–ï¼Œç»„ä»¶å°±ä¼šè¢«åˆ‡æ¢

step 1ï¼š

![step1](assets/img/2021-02-10-20-39-06.png)

é—´æ¥è®©æŒ‰é’®æœ‰çŠ¶æ€ï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½ä¼šæ¸²æŸ“ä¸åŒçš„ Box ç»„ä»¶

step 2ï¼š

![step 2](assets/img/2021-02-10-20-45-39.png)

---

éœ€æ±‚ï¼šæŠŠé¡µé¢åˆ†äº«ç»™å…¶ä»–äºº

æˆ‘ä»¬ç‚¹å‡»äº†æ³¨å†ŒæŒ‰é’®ï¼Œæ¸²æŸ“çš„æ˜¯`Box1`ç»„ä»¶ï¼ˆæ³¨å†Œï¼‰ï¼Œç„¶åæŠŠ URL åˆ†äº«ç»™å…¶ä»–äººï¼Œç»“æœä»–ä»¬æ‰“å¼€é¡µé¢ï¼Œçœ‹åˆ°çš„æ˜¯`Box2`ç»„ä»¶ï¼ˆç™»å½•ï¼‰

å¯ä»¥çœ‹åˆ°è¿™ä¸ç¬¦åˆè·¯ç”±çš„æ„ä¹‰â€”â€”è®©ä¸€ä¸ªç”¨æˆ·å»ä»–æƒ³å»çš„åœ°æ–¹

ç”¨æˆ·æƒ³å»æ³¨å†Œé¡µé¢ï¼Œç»“æœå»çš„æ˜¯ç™»å½•é¡µé¢

ä»æˆ‘ä»¬çš„ä»£ç é‡Œè¾¹å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æˆ‘ä»¬çš„ JS å˜é‡`n`å¦‚ä½•æ”¹å˜ï¼Œåœ°å€æ éƒ½æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œè¿™æ„å‘³ç€ä½ åˆ†äº«ç»™ä»–äººçš„åœ°å€æ°¸è¿œæ˜¯åˆå§‹çŠ¶æ€â€”â€”ç™»å½•ï¼

æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦æŠŠ url ç»™æ”¹å˜äº†ï¼Œé‚£å®ƒå°±å¯ä»¥å»ä¸åŒçš„ç•Œé¢äº†â€¦â€¦

ğŸ’¡ï¼šå¦‚ä½•æ›´æ”¹ url ï¼Ÿ

æµè§ˆå™¨æä¾›äº† hash æ¥ç»™æˆ‘ä»¬æ”¹ï¼

ä¸åŒçš„ç•Œé¢å¯¹åº”ç€ä¸åŒçš„ hashï¼š

``` jsx
import {useState} from "react"
function Box1() {
  return <div className='box'>æ³¨å†Œ</div>
}
function Box2() {
  return <div className='box'>ç™»å½•</div>
}

function App() {
  let [ui,setUi] = useState('ç™»å½•')
  let onClickLogin = ()=> {
    setUi('ç™»å½•')
    window.location.hash = 'login'
  }
  let onClickSignUp = ()=> {
    setUi('æ³¨å†Œ')
    window.location.hash = 'signup'
  }
  return (
    <div className="app">
      <button onClick={onClickLogin}>ç™»å½•</button>
      <button onClick={onClickSignUp}>æ³¨å†Œ</button>
      <div>{ui === 'æ³¨å†Œ' ? <Box1 /> : <Box2 />}</div>
    </div>
  )
}

export default App
```

> ä¸ºäº†è®©ä»£ç æ›´æ˜ç¡®ï¼Œæ‰€ä»¥å°±æŠŠ`0ã€1`æ”¹æˆæ˜¯`ç™»å½•`ã€`æ³¨å†Œ`äº†

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-02-10-21-20-48.png)

è¿™å°±æ˜¯åšè·¯ç”±çš„ç¬¬ä¸€æ­¥äº†ï¼Œå¦‚æœä¸¤ä¸ª`url`éƒ½æ˜¯ä¸€æ ·çš„è¯ï¼Œé‚£ä¹ˆè¿™å°±æ²¡åŠæ³•æŒ‡è·¯äº†â€¦â€¦

å½“ç„¶ï¼Œå°±ç›®å‰è€Œè¨€ï¼Œä¸Šè¾¹çš„ä»£ç æ˜¯æ²¡æœ‰ç”¨çš„ -> æˆ‘ä»¬è¿˜å¾—æ ¹æ®`hash`å»è®¾ç½®åˆå§‹å€¼ï¼

``` jsx
function App() {
  let hash = window.location.hash;
  let initUi = hash === "#signup" ? "æ³¨å†Œ" : "ç™»å½•";
  let [ui, setUi] = useState(initUi);
  let onClickLogin = () => {
    setUi("ç™»å½•");
    window.location.hash = "login";
  };
  let onClickSignUp = () => {
    setUi("æ³¨å†Œ");
    window.location.hash = "signup";
  };
  return (
    <div className="app">
      <button onClick={onClickLogin}>ç™»å½•</button>
      <button onClick={onClickSignUp}>æ³¨å†Œ</button>
      <div>{ui === "æ³¨å†Œ" ? <Box1 /> : <Box2 />}</div>
    </div>
  );
}
```

> ä¸€ä¸ªç–‘é—®ï¼šåˆå§‹å€¼æ¥è‡ªäºå‡½æ•°å¤–é¢çš„`hash`æ˜¯å¦éœ€è¦æ”¾åˆ°`useEffect`é‡Œè¾¹å‘¢ï¼Ÿ

---

å°ç»“ï¼š

- æŠŠä¸€ä¸ªå®¢æˆ·é€å¾€åˆ° ta æƒ³åˆ°çš„ç›®çš„ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯è·¯ç”±äº†ï¼
- å¦‚ä½•å®ç°è·¯ç”±ï¼Ÿ -> æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨`hash`

![è·¯ç”±](assets/img/2021-02-10-22-48-37.png)

æ€»ä¹‹ï¼Œè·¯ç”±åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

1. è·å–å½“å‰çš„`hash`å€¼ï¼Œæ ¹æ®è¿™ä¸ª`hash`å€¼ææ¸…æ¥šç”¨æˆ·æƒ³è¦å»çš„æ˜¯`æ³¨å†Œ`è¿˜æ˜¯`ç™»é™†`
2. åœ¨ä½ åˆ‡æ¢é¡µé¢çš„æ—¶å€™ï¼ˆç‚¹å‡»æŒ‰é’®ï¼‰ï¼ŒæŠŠ`hash`æ”¹æ‰

## â˜…é™¤äº† hash è¿˜èƒ½ç”¨ä»€ä¹ˆ

### <mark>1ï¼‰ç”¨`pathname`</mark>

æˆ‘ä»¬æƒ³ä¸è¦`#xxx`ï¼Œç›´æ¥`/xxx`

ä½†æ˜¯ï¼Œæµè§ˆå™¨é»˜è®¤ï¼Œå¦‚æœä½ æ”¹è·¯å¾„çš„è¯ï¼Œå°±ä¼šåˆ·æ–°æ•´ä¸ªé¡µé¢ï¼ˆæµè§ˆå™¨è®¤ä¸ºä½ è¦è·³è½¬é¡µé¢ï¼Œæ‰€ä»¥ä¼šåˆ·æ–°é¡µé¢ï¼‰â€¦â€¦è€Œ`hash`åˆ™ä¸ä¼šè®©æµè§ˆå™¨è®¤ä¸ºä½ ä¼šè·³è½¬é¡µé¢çš„ï¼

``` jsx
import { useState } from "react";
function Box1() {
  return <div className="box">æ³¨å†Œ</div>;
}
function Box2() {
  return <div className="box">ç™»å½•</div>;
}

function App() {
  let pathName = window.location.pathname;
  let initUi = pathName === "/signup" ? "æ³¨å†Œ" : "ç™»å½•";
  let [ui, setUi] = useState(initUi);
  let onClickLogin = () => {
    setUi("ç™»å½•");
    window.location.pathname = "/login";
  };
  let onClickSignUp = () => {
    setUi("æ³¨å†Œ");
    window.location.pathname = "/signup";
  };
  return (
    <div className="app">
      <button onClick={onClickLogin}>ç™»å½•</button>
      <button onClick={onClickSignUp}>æ³¨å†Œ</button>
      <div>{ui === "æ³¨å†Œ" ? <Box1 /> : <Box2 />}</div>
    </div>
  );
}

export default App;
```

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-02-11-12-50-28.png)

ç›®å‰é‡åˆ°çš„é—®é¢˜ï¼š

1. åªè¦æ”¹`pathname`ï¼Œæµè§ˆå™¨å°±ä¼šåˆ·æ–°é¡µé¢ -> è¿™æ ·ä¸å¥½ï¼Œå› ä¸ºä½ æ€»ä¸èƒ½è®©ç”¨æˆ·åˆ‡ä¸ª`tab`ï¼Œå°±åˆ·æ–°é¡µé¢å§ï¼
2. æ”¹è·¯å¾„è®¿é—®ï¼Œåç«¯å¾ˆæœ‰å¯èƒ½è¿”å›ä¸€ä¸ª `404` é¡µé¢ç»™ä½ 

å¤§å¤šæ•°åå°åº”ç”¨ï¼Œå¦‚æœä½ æ”¹äº†è·¯å¾„ï¼Œè¿”å›ç»™ä½ çš„å°±æ˜¯ `404` äº†ï¼å› ä¸ºé»˜è®¤ä½ åªèƒ½è®¿é—®æ ¹ç›®å½•ï¼Œè€Œå…¶å®ƒè·¯å¾„åˆ™ä¸ä¸€å®šå…è®¸ä½ è®¿é—®äº†ï¼

ğŸ’¡ï¼šä»`codesandbox.io`ä¸‹è½½ä»£ç åˆ°æœ¬åœ°è¿è¡Œï¼Ÿ

![yarn install](assets/img/2021-02-11-13-01-50.png)

### <mark>2ï¼‰ä¸åˆ·æ–°é¡µé¢æ”¹`pathname`çš„æ–¹æ³•</mark>

ä½¿ç”¨æµè§ˆå™¨æä¾›çš„`history.pushState()`æ–¹æ³•ï¼

``` jsx
import { useState } from "react";
function Box1() {
  return <div className="box">æ³¨å†Œ</div>;
}
function Box2() {
  return <div className="box">ç™»å½•</div>;
}

function App() {
  let pathName = window.location.pathname;
  let initUi = pathName === "/signup" ? "æ³¨å†Œ" : "ç™»å½•";
  let [ui, setUi] = useState(initUi);
  let onClickLogin = () => {
    setUi("ç™»å½•");
    window.history.pushState(null,'',"/login")
  };
  let onClickSignUp = () => {
    setUi("æ³¨å†Œ");
    window.history.pushState(null,'',"/signup");
  };
  return (
    <div className="app">
      <button onClick={onClickLogin}>ç™»å½•</button>
      <button onClick={onClickSignUp}>æ³¨å†Œ</button>
      <div>{ui === "æ³¨å†Œ" ? <Box1 /> : <Box2 />}</div>
    </div>
  );
}

export default App;
```

![æ•ˆæœ](assets/img/2021-02-11-13-18-45.png)

å¯ä»¥çœ‹åˆ°ï¼Œè¿™æä¾›äº†æ›´å¥½çœ‹çš„`url`ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šåˆ·æ–°é¡µé¢ï¼

ä½†æ˜¯è¿™è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚å¦‚æœä½ ç›´æ¥è®¿é—®æŸä¸ª`url`è¿˜æ˜¯ä¼šå‡ºç°ç»“æœä¸º`404`çš„æƒ…å†µï¼ -> æ¯•ç«Ÿæˆ‘ä»¬ç›®å‰åªæ˜¯åœ¨å‰ç«¯é¡µé¢è·¯ç”±åˆ‡æ¢ï¼Œå¹¶æ²¡æœ‰å‘èµ·`http`è¯·æ±‚ï¼Œæ€»ä¹‹ï¼Œæœ‰æ—¶å€™è·¯å¾„çœ‹ä¸Šå»æ˜¯å¯¹åº”ç€å†…å®¹ï¼Œä½†æ˜¯ç›´æ¥è¾“å…¥è·¯å¾„æ•²ä¸‹å›è½¦è®¿é—®çš„è¯ï¼Œé‚£ä¹ˆç»“æœå¾ˆæœ‰å¯èƒ½æ˜¯ä¸ª`404`é¡µé¢äº†ï¼

â¹ï¼š[ä¸€ä¸ª popstate çš„ bug å¼•èµ·çš„é›ªå´© - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/32195737)

### <mark>3ï¼‰å°ç»“</mark>

æè·¯ç”±ï¼Œç›®å‰äº†è§£åˆ°æœ‰ä¸‰ç§æ–¹å¼ï¼š

- `window.location.hash` -> url æœ‰ç‚¹ä¸‘ï¼Œä½†å¯ä»¥åšåˆ°ä¸åˆ·æ–°é¡µé¢
- `window.location.pathname` -> ä¼šåˆ·æ–°é¡µé¢ï¼ŒåŸºæœ¬ä¸è€ƒè™‘
- `window.history.pushState(null,'','/login')` -> url å¥½çœ‹ï¼Œä¸“é—¨ç”¨æ¥æè·¯ç”±çš„ï¼Œæ”¹`pathname`ä¸ä¼šåˆ·æ–°é¡µé¢ï¼æ˜¯`pathname`çš„å‡çº§ç‰ˆ

![ä¸‰ç§è·¯ç”±æ–¹å¼](assets/img/2021-02-11-13-31-11.png)

å¦‚æœåç«¯æ²¡æœ‰å¸®æˆ‘ä»¬æŠŠæ‰€æœ‰è·¯å¾„éƒ½æŒ‡å‘æ ¹è·¯å¾„çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸èƒ½ç”¨ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆçš„ï¼ -> ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å‘æ ¹è·¯å¾„çš„é¦–é¡µï¼Ÿ -> ä»¥é˜²`404`é¡µé¢å•Šï¼

æ€»ä¹‹ï¼Œå¦‚æœä½ è‡ªå·±åœ¨åšé¡µé¢ï¼Œåªä¼šå‰ç«¯ä¸ä¼šåç«¯ï¼Œé‚£ä¹ˆåšä¿é™©çš„æ–¹å¼å°±æ˜¯åšç¬¬ä¸€ç§ï¼Œå³ç”¨`hash`å½“è·¯ç”±ï¼å¦‚æœä½ èƒ½æ§åˆ¶åç«¯ï¼Œé‚£ä½ å°±ç”¨ç¬¬ä¸‰ç§ï¼Œå› ä¸ºè¿™ç§`url`æ›´å¥½çœ‹ï¼ -> åƒä¸‡ä¸è¦é€‰æ‹©ç¬¬äºŒç§ï¼

ä»¥ä¸Šå°±æ˜¯å…³äºè¿™ 3 ä¸ª API çš„é€‰æ‹©åˆ†ææƒ…å†µäº†ï¼

## â˜…åç«¯è¦å°†è®©è·¯å¾„éƒ½å±•ç¤ºé¦–é¡µ

### <mark>1ï¼‰ä»€ä¹ˆå«æ‰€æœ‰çš„è·¯å¾„éƒ½æŒ‡å‘é¦–é¡µï¼Ÿ</mark>

ä¸ç®¡ä½ è¾“å…¥ä»€ä¹ˆè·¯å¾„æ•²ä¸‹å›è½¦ï¼Œéƒ½è¿”å›åˆ°é¦–é¡µé¡µé¢ -> è¿™æ˜¯å‰ç«¯åšä¸åˆ°çš„ï¼Œåªæœ‰åç«¯æ‰èƒ½åšï¼ï¼ˆå»å­¦ä¹  Node.js å§ï¼ï¼‰

ç™¾åº¦çš„åšæ³•ï¼š

![ç™¾åº¦çš„åšæ³•](assets/img/2021-02-11-13-43-39.png)

è¿™æ ·çš„åšæ³•æ‰æ˜¯æ­£å¸¸çš„ -> æ‰€æœ‰ä¸å­˜åœ¨çš„ã€æ²¡æœ‰æƒé™çš„è·¯å¾„ï¼Œéƒ½å®šä½è¿™ä¸ª`error`é¡µé¢ï¼

æ­£å¸¸çš„æœåŠ¡å™¨éƒ½è¿™æ ·ï¼Œè€Œä¸æ­£å¸¸çš„ï¼Œä¸ç®¡ä½ è¾“å…¥ä»€ä¹ˆ`url`éƒ½ç»™ä½ å®šä½åˆ°é¦–é¡µï¼

æ€»ä¹‹ï¼Œä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼š

- æŠŠæ‰€æœ‰ä¸å­˜åœ¨çš„è·¯å¾„éƒ½å®šä¸ºé¦–é¡µ
- æŠŠæ‰€æœ‰ä¸å­˜åœ¨çš„è·¯å¾„éƒ½å®šä¸ºä¸å­˜åœ¨çš„é¡µé¢ -> ä¸€èˆ¬çš„åå°éƒ½é€‰æ‹©è¿™ç§ï¼Œå› ä¸ºè¿™ç§æ­£å¸¸ä¸€ç‚¹ï¼

è€Œä½ è¦ç”¨`pushState`å°±å¾—å®šä¸ºé¦–é¡µ -> é€‰æ‹©ç¬¬ä¸€ç§ï¼

> å‰ç«¯è·¯ç”±å°±åªæœ‰`hash`ï¼Œè€Œå¦‚æœä½ è¦äº†è§£åç«¯è·¯ç”±çš„è¯ï¼Œé‚£å°±å¾—å­¦å¾ˆå¤šåç«¯çŸ¥è¯†äº†ï¼Œå¦‚ Nginxã€HTTPã€Expressã€Koa ç­‰

ğŸ’¡ï¼šä¸ºä»€ä¹ˆæˆ‘è¿™ä¸ª React åº”ç”¨ä¹Ÿå¯ä»¥è¿™æ ·ï¼Ÿ

![é¦–é¡µ](assets/img/2021-02-11-13-53-21.png)

ä¹Ÿè®¸ `yarn start` å¯åŠ¨çš„æœåŠ¡ï¼Œä¹Ÿåšäº†æŠŠæ‰€æœ‰è·¯å¾„éƒ½å®šä½åˆ°é¦–é¡µè¿™æ ·çš„äº‹å„¿ï¼

codesanbox ä¹Ÿå¸®æˆ‘ä»¬åšäº†ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½ç”¨`pushState`çš„åŸå› æ‰€åœ¨äº†ï¼

![é¦–é¡µ](assets/img/2021-02-11-13-57-25.png)

## â˜…ä½¿ç”¨ history.pushState åšè·¯ç”±

ä½¿ç”¨`pushState`çš„æ¡ä»¶ï¼š

åç«¯æŠŠæ‰€æœ‰è·¯å¾„éƒ½è®¾ä¸ºé¦–é¡µï¼

ç»†èŠ‚ï¼š

![ç»†èŠ‚](assets/img/2021-02-11-15-34-45.png)

ä»¥ä¸Šå°±æ˜¯é€šè¿‡`pushState`å®ç°çš„å‰ç«¯è·¯ç”±ï¼

## â˜…è·¯ç”±å˜å¤šäº†æ€ä¹ˆåŠ

### <mark>1ï¼‰å¦‚æœæœ‰å¤šä¸ªé¡µé¢ï¼Ÿ</mark>

ç›®å‰æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ï¼Œå°±åªæœ‰ã€Œæ³¨å†Œã€å’Œã€Œç™»å½•ã€é¡µé¢ï¼Œç°åœ¨æˆ‘ä»¬å†åŠ ä¸€ä¸ªã€Œæ¬¢è¿ã€é¡µé¢ï¼ˆè¿™ä¸ªé¡µé¢ä¸€èˆ¬åœ¨ç½‘ç«™é‡Œè¾¹ä¸ä¼šå‡ºç°ï¼Œåœ¨è¿™é‡Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ç½¢äº†ï¼ï¼‰

ä¸‰ä¸ªé¡µé¢ç»™æˆ‘ä»¬å¸¦æ¥çš„éº»çƒ¦ï¼šå¦‚ä½•åˆ¤æ–­ url å±äºå“ªä¸ªé¡µé¢ï¼Ÿ

å¦‚æœæ˜¯ä¸¤ä¸ªé¡µé¢å°±å¾ˆå¥½åˆ¤æ–­äº†ï¼Œè¦ä¹ˆæ˜¯è¿™ä¸ªï¼Œè¦ä¹ˆæ˜¯é‚£ä¸ªï¼Œè€Œä¸‰ä¸ªé¡µé¢ï¼Œåˆ™éœ€è¦åˆ¤æ–­å¾ˆå¤šæ¬¡äº†â€¦â€¦åŒç†ï¼Œ100 ä¸ªé¡µé¢ï¼Œå²‚ä¸æ˜¯ GG äº†ï¼Ÿ

``` jsx
import { useState } from "react";
function Box1() {
  return <div className="box">æ³¨å†Œ</div>;
}
function Box2() {
  return <div className="box">ç™»å½•</div>;
}

function Welcome() {
  return <div className="box">æ¬¢è¿</div>;
}

function App() {
  let pathName = window.location.pathname;
  let initUi = "";
  if (pathName === "/signup") {
    initUi = "æ³¨å†Œ";
  } else if (pathName === "/login") {
    initUi = "ç™»å½•";
  } else {
    initUi = "æ¬¢è¿";
  }
  let [ui, setUi] = useState(initUi);
  let onClickLogin = () => {
    setUi("ç™»å½•");
    window.history.pushState(null, "", "/login");
  };
  let onClickSignUp = () => {
    setUi("æ³¨å†Œ");
    window.history.pushState(null, "", "/signup");
  };
  let onClickWelcome = () => {
    setUi("æ¬¢è¿");
    window.history.pushState(null, "", "/welcome");
  };
  let showUi = () => {
    if (ui === "ç™»å½•") {
      return <Box2 />;
    } else if (ui === "æ³¨å†Œ") {
      return <Box1 />;
    } else {
      return <Welcome />;
    }
  };
  return (
    <div className="app">
      <button onClick={onClickLogin}>ç™»å½•</button>
      <button onClick={onClickSignUp}>æ³¨å†Œ</button>
      <button onClick={onClickWelcome}>æ³¨å†Œ</button>
      <div>{showUi()}</div>
    </div>
  );
}

export default App;
```

ç›®å‰ä»£ç çš„é—®é¢˜ï¼š

- å¦‚æœ`path`è¿‡å¤šï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·å»çš„ç›®çš„åœ°è¿‡å¤šï¼Œé‚£ä¹ˆ`ifâ€¦â€¦else`å°±å¾—å†™å¾—å¾ˆé•¿
- å¦‚æœè·¯ç”±æ— é™å¤šä¸ªï¼Œå¦‚`/users/1`ã€`/users/2`â€¦â€¦`/users/10000`è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ— æ³•å†™äº†â€¦â€¦ä¸ç„¶ï¼Œä½ è¦å†™æ— é™è¡Œä»£ç å—ï¼Ÿ

ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¾—ä½¿ç”¨ä¸€äº›æ›´é«˜çº§çš„ä¸œè¥¿äº† -> åŸºæœ¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æè¿™äº›äº‹å„¿ï¼

ä¸è¿‡ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº›åº“å°±èƒ½è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜äº†ï¼

`react-router-dom`å°±èƒ½è§£å†³å¾ˆå¤šä¸ª`path`ï¼Œç”šè‡³æ— ç©·å¤šä¸ªè·¯ç”±çš„é—®é¢˜ï¼

## â˜…å®‰è£…å’Œé…ç½® ReactRouter

### <mark>1ï¼‰ä½¿ç”¨ React-Router æ”¹å†™ä¹‹å‰çš„ä¾‹å­</mark>

å®˜ç½‘ï¼š[React Router: Declarative Routing for React.js](https://reactrouter.com/web/guides/quick-start)

![æ¦‚è¿°](assets/img/2021-02-11-16-42-30.png)

> è¿™ä¸ªåŒæ­¥å°±åƒæˆ‘ä»¬ä¸Šè¾¹å†™çš„ä¾‹å­ä¸€æ ·ï¼Œç‚¹å‡»å°±æ›´æ–° UIï¼Œåœ°å€æ  URL ä¹Ÿéšç€æ”¹å˜ï¼Œåœ°å€æ  URL å˜ï¼ŒUI ä¹Ÿè·Ÿç€å˜

æ‰¾ä¾‹å­ï¼ŒCRM å¤§æ³•ï¼ -> åƒä¸‡ä¸è¦åŸåˆ›ï¼Œå…ˆæŠ„ quick start å°±å®Œäº‹å„¿äº†ï¼ä¹‹åå†æ…¢æ…¢æ”¹ï¼

ğŸ’¡ï¼šreact-router 4.0 æ— æ³• `import` `hashHistory`

3.0.2 æ˜¯å¯ä»¥çš„ï¼

ä¸­æ–‡æ–‡æ¡£ï¼š[Introduction - React Router ä¸­æ–‡æ–‡æ¡£](https://react-guide.github.io/react-router-cn/)

è¯¥æ–‡æ¡£å·²ç»è¿‡æ—¶äº†ï¼è¯·çœ‹è‹±æ–‡æ–‡æ¡£ï¼

> ä¸è¦è£…`react-router` -> å¦‚æœè£…äº†ï¼Œé‚£ä¹ˆä»£ç å°±éœ€è¦ä½ è‡ªå·±å»ç›‘å¬`hashchange`äº†

## â˜…ä¸Šæ‰‹ ReactRouter

### <mark>1ï¼‰react-router-dom</mark>

å¯ä»¥çœ‹åˆ°ï¼Œè·¯ç”±å†™å¾—ç‰¹åˆ«ç®€å•ï¼Œåªè¦ç”¨æ ‡ç­¾å°±è¡Œäº†ï¼Œä¸ç”¨å†™ä»€ä¹ˆ`ifâ€¦â€¦elseâ€¦â€¦`ï¼Œ`button`æŒ‰é’®äº†ï¼

ä¹‹å‰æ–¹æ–¹è®²çš„æ˜¯åŸç†ï¼Œè€Œ react-router-dom å°±åŸºäºåŸç†åšäº†éå¸¸å¤šçš„ä¼˜åŒ–ï¼Œä½¿æˆ‘ä»¬åƒå†™æ ‡ç­¾é‚£æ ·ï¼Œç‚¹å‡»ä¸€ä¸ªè¶…é“¾æ¥å°±åˆ°æŸä¸ªåœ°æ–¹å»ä¸€æ ·ï¼

ä»£ç ï¼š

``` jsx
import React from "react";
import { BrowserRouter as Router, Switch, Route, Link } from "react-router-dom";

export default function App() {
  return (
    <Router>
      <div>
        <Link to="/">é¦–é¡µ</Link> | 
        <Link to="/signup"> æ³¨å†Œ</Link> | 
        <Link to="/login"> ç™»å½•</Link> | 
        <Link to="/welcome"> æ¬¢è¿</Link>

        <Switch>
          <Route path="/signup">
            <Box1 />
          </Route>
          <Route path="/login">
            <Box2 />
          </Route>
          <Route path="/welcome">
            <Welcome />
          </Route>
          <Route path="/">
            <Home />
          </Route>
        </Switch>
      </div>
    </Router>
  );
}

function Box1() {
  return <div className="box">æ³¨å†Œ</div>;
}
function Box2() {
  return <div className="box">ç™»å½•</div>;
}

function Welcome() {
  return <div className="box">æ¬¢è¿</div>;
}

function Home() {
  return <div className="box">é¦–é¡µ</div>;
}
```

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-02-11-18-03-01.png)

å¯ä»¥çœ‹åˆ°ï¼ŒUI çš„æ¸²æŸ“æ˜¯ä¸ url æ¯æ¯ç›¸å…³çš„ï¼

å¦‚æœä½ è¦å»ã€Œæ³¨å†Œã€é¡µé¢ï¼Œé‚£å°±ç‚¹å‡»æ³¨å†Œé“¾æ¥ -> æ²¡æœ‰åˆ·æ–°é¡µé¢ï¼

æ—§çš„å†™æ³•ï¼š

![æ—§çš„å†™æ³•](assets/img/2021-02-11-18-06-57.png)

`Route`æ ‡ç­¾å’Œ`component`å±æ€§çš„é…åˆå°±åƒæ˜¯`ifâ€¦â€¦elseâ€¦â€¦`è¿™æ ·ï¼

è€Œ`Link`å°±æ˜¯åœ¨åš`pushState`çš„äº‹å„¿ï¼

### <mark>2ï¼‰å°ç»“</mark>

åŸç”Ÿ JS å¦‚ä½•å®ç°è·¯ç”±ï¼ŸReact åˆæ˜¯å¦‚ä½•å®ç°è·¯ç”±çš„ï¼Ÿ

![å±€éƒ¨ UI](assets/img/2021-02-11-18-40-00.png)

## â˜…æµ‹è¯•

router

è¯·ä½¿ç”¨ ReactRouter åšå‡ºä¸€ä¸ª tab åˆ‡æ¢

1. ç‚¹å‡» 1 åˆ™æ˜¾ç¤º tab 1
2. ç‚¹å‡» 2 åˆ™æ˜¾ç¤º tab 2
3. é‡è¦ï¼šåˆ·æ–°é¡µé¢åè¿˜æ˜¯æ˜¾ç¤ºå¯¹åº”çš„ tab

``` jsx
import React from "react";
import { BrowserRouter as Router, Switch, Route, Link } from "react-router-dom";

export default function Tab() {
  return (
    <div>
      <Router>
        <Link to="/tab1">Tab1</Link>
        <Link to="/tab2">Tab2</Link>
        <Switch>
          <Route exact path="/">
            <Tab1 />
          </Route>
          <Route path="/tab1">
            <Tab1 />
          </Route>
          <Route path="/tab2">
            <Tab2 />
          </Route>
        </Switch>
      </Router>
    </div>
  );
}

function Tab1() {
  return <div>Tab1</div>;
}
function Tab2() {
  return <div>Tab2</div>;
}

```

> å†™åˆ°å‰é¢å¿…é¡»åŠ ä¸Š`exact`ï¼Œå¦‚æœä¸åŠ ï¼Œé‚£å°±æŠŠå®ƒå†™åˆ°åé¢å»ï¼

ä¸€ä¸ªç–‘é—®ï¼šå¦‚ä½•åšå¤šä¸ªè·¯å¾„åŒ¹é…ä¸€ä¸ªç»„ä»¶ï¼Ÿ

â¹ï¼š[React Routerä¸­åŒä¸€ç»„ä»¶çš„å¤šä¸ªè·¯å¾„å](https://qastack.cn/programming/40541994/multiple-path-names-for-a-same-component-in-react-router)


## â˜…äº†è§£æ›´å¤š

â¹ï¼š[React Router ä½¿ç”¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2016/05/react_router.html)

â¹ï¼š[react-router-tutorial/lessons at master Â· reactjs/react-router-tutorial](https://github.com/reactjs/react-router-tutorial/tree/master/lessons)

â¹ï¼š[What is Routing in web development? â€“ DivPusher](https://divpusher.com/glossary/routing/)

â¹ï¼š[react router - What is routing? Why is "routing" needed in single page web apps? - Stack Overflow](https://stackoverflow.com/questions/39636411/what-is-routing-why-is-routing-needed-in-single-page-web-apps)

â¹ï¼š[reactè·¯ç”±è¡¥å……éƒ¨åˆ†ï¼ˆexactã€å…«ä¸ªè·¯ç”±ç¤ºä¾‹ï¼‰_mapbar_frontçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/mapbar_front/article/details/72832057)

