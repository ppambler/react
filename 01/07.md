### âœï¸ Tangxt â³ 2021-02-06 ğŸ·ï¸ Hooks API

# 07-React Hooks API

## â˜…è¯¾ç¨‹ç®€ä»‹

å¦‚æœè‡ªå­¦å¯çœ‹è¿™å‡ ä¸ªé“¾æ¥ï¼š

è‹±æ–‡æ–‡æ¡£ï¼š[è¿™é‡Œ](https://reactjs.org/docs/hooks-intro.html) å’Œ [è¿™é‡Œ](https://reactjs.org/docs/hooks-reference.html)

ä¸­æ–‡è§£æï¼š[è¿™é‡Œ](https://github.com/dt-fe/weekly/blob/master/79.%E7%B2%BE%E8%AF%BB%E3%80%8AReact%20Hooks%E3%80%8B.md)

1. useState
2. useEffect
3. è‡ªå·±çš„ Hook
4. çœ‹ä¸€çœ‹æ‰€æœ‰ Hooks API

## â˜…æ¦‚è¿°

Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚

å®ƒæ——ä¸‹æœ‰è¿™ä¹ˆå‡ ä¸ª APIï¼š

![Hooks API](assets/img/2021-02-07-11-04-42.png)

> ææ‡‚äº†è¿™ 10 ä¸ª APIï¼Œç®—æ˜¯å½»åº•äº†è§£äº† Hooks API äº†

å…³äºè¿™ç¯‡ [æ–‡ç« ](https://github.com/dt-fe/weekly/blob/master/79.%E7%B2%BE%E8%AF%BB%E3%80%8AReact%20Hooks%E3%80%8B.md):

![æ–‡ç«  1](assets/img/2021-02-07-11-09-18.png)

åˆå­¦è€…éœ€è¦æ•™å­¦è€…é€šè¿‡ä¸€äº›ä»£ç æ¯”è¾ƒæ™ºéšœçš„æ–¹æ³•æ¥æ•™ä¼šä»–ä»¬â€¦â€¦

## â˜…useState çš„ä½¿ç”¨

### <mark>1ï¼‰æŸ¥çœ‹ä¸€ä¸ªåº“ç›®å‰çš„ç‰ˆæœ¬å†å²</mark>

``` bash
yarn info react versions
```

æœ‰ä¸€äº›æ–°ç‰¹æ€§ï¼Œä½ éœ€è¦å®‰è£…`alpha`ç‰ˆæœ¬æ‰èƒ½ç”¨ï¼š

![alpha](assets/img/2021-02-08-10-57-36.png)

æŠŠ`package.json`é‡Œè¾¹çš„`dependencies`å­—æ®µæ——ä¸‹çš„`react`å’Œ`react-dom`æ”¹æˆè¿™ä¸ª`alpha`ç‰ˆçš„ï¼Œé‡æ–°`yarn add`ä¸€ä¸‹å°±å¥½äº†ï¼

> ç”¨ codesandbox ä¼šæ›´ç®€å•ï¼æ”¹ä¸€ä¸‹å€¼ï¼Œå°±èƒ½è‡ªåŠ¨æ›´æ–°åº“çš„ç‰ˆæœ¬äº†ï¼

### <mark>2ï¼‰å‡½æ•°ä¹Ÿæœ‰çŠ¶æ€</mark>

ä¹‹å‰è¯´åˆ°ï¼Œå‡½æ•°ç»„ä»¶æ˜¯å’©æœ‰çŠ¶æ€çš„ï¼Œå¦‚æœä½ è¦æƒ³æœ‰çŠ¶æ€çš„è¯ï¼Œé‚£å°±å¾—ç”¨`class`ç»„ä»¶ï¼Œä¸è¿‡ï¼Œä¹‹åå‡ºäº†è¿™ä¸ª Hooks APIï¼Œæ„å‘³ç€å‡½æ•°ä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„ï¼

#### <mark>1ã€å‡½æ•°æœ‰çŠ¶æ€çš„ä¾‹å­</mark>

æ²¡æœ‰ Hooks API ä¹‹å‰ï¼Œä½ æƒ³è¿™æ ·å†™ï¼š

![Hooks API](assets/img/2021-02-08-17-57-19.png)

æœ‰äº† Hooks API ä¹‹åï¼š

``` jsx
function App() {
  // count çš„åˆå§‹å€¼ä¸º 0ï¼ŒsetCount è¡¨ç¤ºæ›´æ–° count çš„å‡½æ•°
  // è¿”å›ä¸€ä¸ªæ•°ç»„
  const [count, setCount] = useState(0);
  const add = (n) => {
    setCount(count+n)
  }
  return (
    <div>
      <div>{count}</div>
      <div>
        <button onClick={() => { add(1); }} > +1 </button>
      </div>
    </div>
  );
}
```

å¯ä»¥çœ‹åˆ°è‡ªä»æœ‰äº†`useState`ä¹‹åï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ç”¨`class`æ¥ç»´æŠ¤ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€äº†ï¼ -> ç›´æ¥å°±æ˜¯é€šè¿‡`useState`ï¼Œç„¶åç»™ä¸€ä¸ªåˆå§‹çš„`0`ï¼Œç„¶åå†é€šè¿‡`count`æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œå¦‚æœè¦æ›´æ–°`count`é‚£å°±è°ƒç”¨`setCount`

ğŸ’¡ï¼šä¸¤æ¬¡å¼•å…¥`react`ï¼Œä¹Ÿæ˜¯åªæœ‰ä¸€æ¬¡åŠ è½½ï¼Ÿ

![ä¸¤æ¬¡å¼•å…¥](assets/img/2021-02-08-18-01-17.png)

#### <mark>2ã€ç”¨`class`æ¥å†™ä¸€é</mark>

ç”¨äº†`useState`ä¹‹åï¼Œä»£ç å˜å¾—æ›´ç®€æ´äº†ï¼Œé‚£æˆ‘ä»¬ä¹‹å‰ç”¨`class`æ˜¯æ€ä¹ˆå†™çš„å‘¢ï¼Ÿ

``` jsx
class App1 extends Component {
  constructor() {
    super();
    this.state = {
      count: 0,
    };
  }
  add(n) {
    this.setState({
      count: this.state.count + n,
    });
  }
  minus(n) {
    this.setState({
      count: this.state.count - n,
    });
  }
  render() {
    return (
      <div>
        <div>{this.state.count}</div>
        <div>
          <button onClick={() => { this.add(1); }} > {" "} +1{" "} </button> 
          <button onClick={() => { this.minus(1); }} > {" "} -1{" "} </button>
        </div>
      </div>
    );
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦å†™è¿™äº›åºŸè¯ï¼š

- `extends Component`
- `constructor`
- `super`
- `this`
- `render`

è€Œæˆ‘ä»¬ç”¨äº† Hooks API çš„å‡½æ•°ç»„ä»¶ï¼Œå°±æ²¡æœ‰åºŸè¯äº†â€¦â€¦æ¯ä¸€è¡Œä»£ç éƒ½æ²¡æœ‰å¤šä½™çš„â€¦â€¦

### <mark>3ï¼‰å°ç»“</mark>

- æ°¸è¿œä¸å†éœ€è¦`class`ç»„ä»¶äº†ï¼Œåªè¦ä½ æŠŠ React å‡çº§åˆ° 16.8
- ä¹Ÿè®¸ä½ ä¹Ÿä¸å†éœ€è¦ Redux äº†ï¼Œå½“ç„¶ï¼ŒRedux è¿˜æ˜¯æœ‰å®ƒæ‰€å­˜åœ¨çš„ä»·å€¼çš„ï¼Œæ¯•ç«Ÿå®ƒçš„ç”Ÿæ€å¾ˆå¥½ -> ä¸è¿‡ï¼Œç”¨äº† Hooks API åï¼Œç»„ä»¶çŠ¶æ€å°±å¯ä»¥ç›´æ¥å…±ç”¨äº†ï¼
- ä½¿ç”¨`useState`ä¹‹åï¼Œé‚£å°±æ„å‘³ç€ä½ å¯ä»¥å¾ˆç®€å•çš„è¿›è¡Œå‡½æ•°çš„èµ‹å€¼å’Œæ›´æ–°äº†

## â˜…useState æ›´å¤šä¾‹å­

### <mark>1ï¼‰å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªçŠ¶æ€å—ï¼Ÿ</mark>

``` jsx
function App() {
  // count çš„åˆå§‹å€¼ä¸º 0ï¼ŒsetCount è¡¨ç¤ºæ›´æ–° count çš„å‡½æ•°
  const [count, setCount] = useState(0);
  const [user,setUser]= useState({name:'frank',age:18})
  const add = (n) => {
    setCount(count + n);
  };
  const minus = (n) => {
    setCount(count - 1);
  };
  const old = (n) => {
    setUser({
      ...user,
      age: user.age +1
    })
  }
  return (
    <div>
      <div>{count}</div>
      <div>
        <button onClick={() => { add(1); }} > {" "} +1{" "} </button> 
        <button onClick={() => { minus(1); }} > {" "} -1{" "} </button>
      </div>
      <div>{user.name},{user.age}</div>
      <button onClick={()=>{old(1)}}>age + 1</button>
    </div>
  );
}
```

å¦‚æœä½ æƒ³æ›´æ–°å¤æ‚çš„`state`ï¼Œé‚£ä¹ˆå…¶å®ƒä¸æ›´æ–°çš„å±æ€§ç›´æ¥æ‹·è´ï¼Œæ›´æ–°çš„åˆ™èµ‹å€¼â€¦â€¦

ğŸ’¡ï¼š`setX`è¿™æ ·å°±æ˜¯åœ¨ç»™ä¸€ä¸ª`x`èµ‹å€¼ï¼Œä½†æ˜¯æˆ‘å¾ˆå¥½å¥‡çš„æ˜¯ï¼Œ`x`å°±æ˜¯`const`å£°æ˜çš„å˜é‡å•Šï¼ä¸ºå•¥è¿˜å¯ä»¥é‡æ–°èµ‹å€¼å‘¢ï¼Ÿ

åœ¨`setUser`çš„æ—¶å€™ï¼Œä¸èƒ½å•ç‹¬å¯¹æŸä¸ªå±æ€§è¯¥å€¼ï¼Œä½ å¾—æŠŠåŸå±æ€§æè¿‡æ¥åå†æ”¹å€¼â€¦â€¦

> é‡æ–°å‘ˆç°ç»„ä»¶åï¼Œå°†**å†æ¬¡æ‰§è¡Œè¯¥å‡½æ•°**ï¼Œä»è€Œåˆ›å»º**æ–°çš„ä½œç”¨åŸŸ**ï¼Œåˆ›å»ºæ–°çš„`user`å˜é‡ï¼Œ**è¯¥å˜é‡ä¸å…ˆå‰çš„å˜é‡æ— å…³**ã€‚

â¹ï¼š[ä¸ºä»€ä¹ˆ useState å¯ä»¥ä½¿ç”¨ const è§£æ„èµ‹å€¼ï¼Ÿ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/242792793)

### <mark>2ï¼‰å¦‚æœçŠ¶æ€æ˜¯æ•°ç»„ç±»å‹çš„å€¼</mark>

éœ€æ±‚ï¼š

- æ·»åŠ çˆ±å¥½
- åˆ é™¤çˆ±å¥½

``` jsx
function App() {
  // count çš„åˆå§‹å€¼ä¸º 0ï¼ŒsetCount è¡¨ç¤ºæ›´æ–° count çš„å‡½æ•°
  const [count, setCount] = useState(0);
  let [user,setUser]= useState({name:'frank',age:18,hobbies:['æ‰“ lol','æ•² code','çœ‹ç¯®çƒ']})
  const add = (n) => {
    setCount(count + n);
  };
  const minus = (n) => {
    setCount(count - 1);
  };
  const old = (n) => {
    setUser({
      ...user,
      age: user.age +1
    })
  }
  const delHobby = () => {
    // è¿™ç§å†™æ³•å¾ˆä¸ç›´è§‚â€¦â€¦
    // åˆ é™¤ç¬¬äºŒé¡¹â€¦â€¦
    user.hobbies.splice(1,1)
    setUser({
      ...user
    })
  }
  const addHobby = () => {
    // å§¿åŠ¿ 1
    // user.hobbies.push(Math.random())
    // setUser({
    //   ...user
    // })
    // å§¿åŠ¿ 2
    let newHobby = Math.random()
    setUser({
      ...user,
      hobbies:[...user.hobbies,newHobby]
    })
  }
  return (
    <div>
      <div>{count}</div>
      <div>
        <button onClick={() => { add(1); }} > {" "} +1{" "} </button> 
        <button onClick={() => { minus(1); }} > {" "} -1{" "} </button>
      </div>
      <div>{user.name},{user.age}</div>
      <button onClick={()=>{old(1)}}>age + 1</button>
      <div>{user.hobbies.join(',')}</div>
      <button onClick={()=>{delHobby()}}>åˆ é™¤ä¸€ä¸ªçˆ±å¥½</button>
      <button onClick={()=>{addHobby()}}>æ·»åŠ ä¸€ä¸ªçˆ±å¥½</button>
    </div>
  );
}
```

ä¸ç®¡æ˜¯ç®€å•çš„`0`ï¼Œè¿˜æ˜¯å¤æ‚çš„æ•°ç»„ï¼Œéƒ½å¯ä»¥ç”¨`useState`æ¥æ”¹å˜å‡½æ•°çš„çŠ¶æ€ï¼ -> åŠŸèƒ½éƒ½å¯ä»¥å®ç°ï¼Œåªæ˜¯å°±å¾—å†™ä¸€äº›å¤æ‚çš„ JS ä»£ç ç½¢äº†ï¼

æ€»ä¹‹ï¼Œå‡½æ•°ç»„ä»¶ä¸ä»…å¯ä»¥æœ‰ä¸€ä¸ª`state`ï¼Œè¿˜å¯ä»¥æœ‰å¤šä¸ª`state`ï¼Œè€Œä¸”æ¯ä¸ª`state`ä¹Ÿå¯ä»¥æœ‰å¤æ‚çš„ç»“æ„ï¼

### <mark>3ï¼‰æ”¹ä¹±ä¾‹å­ï¼Œæ‰¾çŸ¥è¯†</mark>

ğŸ’¡ï¼šèƒ½å¦æŠŠ`useState`ä»£ç å†™åˆ°`App`å‡½æ•°çš„å¤–è¾¹å»å‘¢ï¼Ÿ

> CRM å¥—è·¯ï¼Œä¸€æ—¦ copy çš„ä»£ç ï¼Œè¿è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬å°±åœ¨è¿™ä¸ªä»£ç çš„åŸºç¡€ä¸Šå„ç§æ”¹ï¼

![æ”¾åˆ°å‡½æ•°å¤–è¾¹å»](assets/img/2021-02-09-16-01-27.png)

ä»£ç ç¼–è¯‘ç»“æœï¼š

```
src\demo\Add.js
  Line 4:27:  React Hook "useState" cannot be called at the top level. React Hooks must be called in a React function component or a custom React Hook function  react-hooks/rules-of-hooks

Search for the keywords to learn more about each error.
```

è¿™å°±æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£é‡Œè¾¹æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬çš„çŸ¥è¯†ï¼š**ä½ ä¸èƒ½æŠŠ`useState`æ‹¿åˆ°å‡½æ•°å¤–è¾¹å»** -> æ²¡æœ‰ä¸ºä»€ä¹ˆï¼ŒReact å°±æ˜¯ä¸å‡†ï¼

è¿™ä¸ªé—®é¢˜å‘Šè¯‰æˆ‘ä»¬ã€Œ**å¹¶ä¸éœ€è¦ä¸€ç›´æ­»ç£•æ–‡æ¡£ï¼Œæœ‰æ—¶å€™åªéœ€è¦ç¨å¾®æ”¹ä¸€ä¸‹ä¾‹å­ï¼Œå°±èƒ½å‘ç°ä¸€äº›æˆ‘ä»¬ä¸èƒ½è¿™æ ·åšçš„çŸ¥è¯†ç‚¹äº†**ã€

ğŸ’¡ï¼šçŠ¶æ€åä»¥åŠä¿®æ”¹çŠ¶æ€çš„å‡½æ•°åèƒ½å¦éšæ„èµ·åï¼Ÿ

æŠŠ

``` js
const [count, setCount] = useState(0);
```

æ”¹æˆè¿™æ ·çš„ï¼š

``` js
const [x, y] = useState(0);
```

ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªè¦ææ¸…æ¥šé¡ºåºå°±å¥½äº† -> ç¬¬ä¸€ä¸ªæ˜¯çŠ¶æ€ï¼Œç¬¬äºŒä¸ªæ˜¯æ”¹çŠ¶æ€çš„èµ‹å€¼å‡½æ•°

æ€»ä¹‹ï¼Œè¿™ä¸åå­—æ— å…³ï¼

---

æ–¹æ–¹å­¦ä¹ å¥—è·¯ï¼šæŠŠå¯ä»¥æ”¹çš„éƒ½æ”¹ä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆæ•ˆæœï¼Œç„¶åå†æŠŠæ•ˆæœè®°å½•ä¸‹æ¥ï¼

## â˜…useEffect çš„ä½¿ç”¨

æ–‡æ¡£ï¼š[ä½¿ç”¨ Effect Hook â€“ React](https://zh-hans.reactjs.org/docs/hooks-effect.html)ã€[ä½¿ç”¨ Effect Hook â€“ React ä¸­æ–‡æ–‡æ¡£ v16.6.3](https://react.css88.com/docs/hooks-effect.html)

### <mark>1ï¼‰ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ</mark>

è¦äº†è§£`Effect Hook`ï¼Œå¿…é¡»å…ˆäº†è§£ã€Œå‰¯ä½œç”¨ã€

![å‰¯ä½œç”¨](assets/img/2021-02-09-16-51-21.png)

è¿™å°±åƒæ˜¯é«˜ä¸­è‹±è¯­å¬åŠ›ä¸€æ · -> é‡è¦çš„é‚£ä¸ªå•è¯è€æ˜¯å¬ä¸æ‡‚â€¦â€¦

---

ç”¨é€šä¿—çš„è¯æ¥è®²ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼ˆ**å¯èƒ½ä¸å¯¹ï¼Œä½†è‡³å°‘èƒ½å¬æ‡‚**ï¼‰ï¼š

> å¦‚æœä½ åœ¨çœ‹ä¸€ä¸ªå‡½æ•°ï¼Œå‘ç°å®ƒçš„å‡½æ•°ä½“é‡Œè¾¹æœ‰ä»£ç ä¸çŸ¥é“æ˜¯å“ªå„¿æ¥çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼å› ä¸ºå®ƒä¾èµ–äº†ä¸çŸ¥é“ä»å“ªå„¿æ¥çš„ä¸œè¥¿ï¼

![å‰¯ä½œç”¨](assets/img/2021-02-09-17-04-20.png)

ç”Ÿæ´»ä¾‹å­ï¼š

- å¹²å‡€çš„å±‹å­ï¼Œä¸çŸ¥é“å“ªæ¥çš„å¡‘æ–™è¢‹ä»çª—å£é£˜è¿›æ¥äº†ï¼Œè®©äººçªå…€å°±æ˜¯å‰¯ä½œç”¨
- åƒè¯ï¼Œè‚šå­ç—›å°±æ˜¯å‰¯ä½œç”¨

æ€»ä¹‹ï¼Œå°±æ˜¯ä¸€äº›è®©ä½ æ„Ÿåˆ°æƒŠè®¶çš„ä¸œè¥¿å‡ºç°åœ¨äº†ä¸è¯¥å‡ºç°çš„åœ°æ–¹â€¦â€¦

> å‰¯ä½œç”¨å°±æ˜¯ä¾èµ–äº†ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„å‡½æ•°ï¼å½“ç„¶ï¼Œè¿™å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆåå¤„ï¼

### <mark>2ï¼‰Effect Hook</mark>

å¦‚æœä½ çš„è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªæœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œé‚£ä¹ˆä½ å°±æŠŠè¿™ä¸ªå‡½æ•°å†™åˆ°`useEffect`é‡Œè¾¹

ä¾‹å­ï¼šæŠŠçŠ¶æ€äº¤ç»™ä¸`div#root`åŒçº§çš„`div#output`

![ä¾‹å­](assets/img/2021-02-09-17-20-56.png)

> æˆ‘æŒºæƒ³çŸ¥é“ Hook API çš„æ‰§è¡Œæ—¶æœºæ˜¯æ€æ ·çš„ï¼Œåœ¨ä¸Šè¾¹è¿™ä¸ªä¾‹å­é‡Œè¾¹ï¼Œæˆ‘æ›´æ–°äº†`count`çš„å€¼ï¼Œ`div#output`çš„å†…å®¹å°±ä¼šè‡ªåŠ¨æ”¹å˜â€¦â€¦éš¾é“æ¯æ¬¡æ›´æ–°çŠ¶æ€ï¼Œ`Effect`è¿™ä¸ªå‡½æ•°éƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éå—ï¼Ÿ

å°ç»“ï¼š

- çŸ¥é“ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨
- çŸ¥é“åœ¨`useEffect`é‡Œè¾¹å¯ä»¥å¼•å…¥æœ€æ–°çš„`count`çš„å€¼

## â˜…æµ‹è¯•

> Hooks API

è¯·ä½¿ç”¨ Hooks API åšå‡ºä¸€ä¸ª couter åº”ç”¨ï¼š

1. é¡µé¢ä¸Šæœ‰ä¸€ä¸ªæ•°å­— n å’Œä¸€ä¸ªæŒ‰é’® +1
2. ç‚¹å‡» +1 ä¹‹å n å°±ä¼šåŠ  1 -> ç®€å•å§

``` jsx
function Test() {
  const [n, setN] = useState(0);
  const add1 = () => {
    setN(n + 1);
  };
  return (
    <div>
      <div>{n}</div>
      <button
        onClick={() => {
          add1();
        }}
      >
        +1
      </button>
    </div>
  );
}
```

## â˜…äº†è§£æ›´å¤š

- [React Hooks å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](https://www.ruanyifeng.com/blog/2019/09/react-hooks.html)
- [è½»æ¾å­¦ä¼š React é’©å­ï¼šä»¥ useEffect() ä¸ºä¾‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2020/09/react-hooks-useeffect-tutorial.html)